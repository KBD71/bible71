<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9월 26일 - 맥체인 성경읽기 (최종 수정)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=KoPub+Batang:wght@400;700&family=Pretendard:wght@400;700&display=swap');

        :root {
            --font-serif: 'KoPub Batang', serif;
            --font-sans-serif: 'Pretendard', sans-serif;
            
            --color-text: #212529;
            --color-background: #f8f9fa;
            --color-card-bg: #ffffff;
            --color-border: #dee2e6;

            --color-book1: #4285F4;
            --color-book2: #DB4437;
            --color-book3: #c89200;
            --color-book4: #0F9D58;
            --color-integration: #5f6368;

            --spacing-unit: 1rem;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-serif);
            font-size: 17px;
            line-height: 1.8;
            color: var(--color-text);
            background-color: var(--color-background);
            margin: 0;
            padding: var(--spacing-unit);
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1280px;
            padding: 0 var(--spacing-unit);
        }

        header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 3);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--spacing-unit);
        }

        h1 {
            font-family: var(--font-sans-serif);
            font-size: clamp(2rem, 5vw, 2.8rem);
            font-weight: 700;
            margin: 0.5em 0;
        }
        
        h2 {
            font-family: var(--font-sans-serif);
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            margin-top: calc(var(--spacing-unit) * 3);
            margin-bottom: var(--spacing-unit);
            border-bottom: 2px solid var(--color-border);
            padding-bottom: calc(var(--spacing-unit) * 0.5);
        }
        
        h3 {
            font-family: var(--font-sans-serif);
            font-size: 1.3rem;
            font-weight: 700;
        }

        .chapter-card, .integration-card {
            background-color: var(--color-card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: calc(var(--spacing-unit) * 2.5);
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 2);
            border-left: 8px solid;
        }
        
        .card-book1 { border-color: var(--color-book1); }
        .card-book1 h3 { color: var(--color-book1); }
        .card-book2 { border-color: var(--color-book2); }
        .card-book2 h3 { color: var(--color-book2); }
        .card-book3 { border-color: var(--color-book3); }
        .card-book3 h3 { color: var(--color-book3); }
        .card-book4 { border-color: var(--color-book4); }
        .card-book4 h3 { color: var(--color-book4); }
        .integration-card { border-color: var(--color-integration); }
        .integration-card h3 { color: var(--color-integration); }

        .btn-group {
            margin-top: calc(var(--spacing-unit) * 1.5);
            display: flex;
            gap: var(--spacing-unit);
            flex-wrap: wrap;
        }

        .btn {
            font-family: var(--font-sans-serif);
            padding: 0.6em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            display: inline-block;
            color: white;
        }

        .btn-view { background-color: #343a40; }
        .btn-listen { background-color: var(--color-integration); }

        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.15);
        }
        .btn:active {
            transform: translateY(0);
            filter: brightness(0.95);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: var(--color-card-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            position: relative;
            animation: slideIn 0.3s;
        }
        
        .modal-body {
             max-height: 70vh;
             overflow-y: auto;
             font-size: 18px;
             line-height: 2;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 100px auto;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { translateY(0); opacity: 1; } }

        .audio-player {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 500px;
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: bottom 0.3s ease-in-out;
            z-index: 1001;
        }
        .audio-player.show { bottom: 0; }
        .audio-player-info { font-family: var(--font-sans-serif); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .audio-player-controls button { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; margin-left: 15px; }
        .audio-player-controls button:hover { color: #bdc3c7; }
        #youtube-player-container { display: none; }

        footer {
            text-align: center;
            margin-top: calc(var(--spacing-unit) * 4);
            padding: calc(var(--spacing-unit) * 2) 0;
            border-top: 1px solid var(--color-border);
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <header>
            <h1>9월 26일</h1>
            <p>하나님의 주권적 구원과 인간의 믿음</p>
        </header>

        <main>
            <div class="chapter-card card-book1">
                <h3>사무엘하 22장: 구원의 반석, 나의 하나님</h3>
                <h4>상세 개요</h4>
                <p>사무엘하 22장은 다윗이 그의 모든 원수와 사울의 손에서 구원받은 후 하나님께 드리는 장엄한 승리의 노래입니다. 시편 18편과 거의 동일한 이 노래는 다윗의 파란만장한 일생 동안 함께하신 하나님의 주권적 구원 역사를 회고합니다. 다윗은 하나님을 자신의 반석, 요새, 구원자, 피난처 등 견고한 이미지로 묘사하며(1-4절), 자신이 처했던 죽음의 위협("사망의 줄", 5절)과 하나님의 압도적인 현현(Theophany)을 통해 임한 구원을 생생하게 대조합니다(5-20절). 마지막으로 그는 하나님의 공의로운 심판과 언약적 신실하심을 찬양하며, 자신의 삶이 하나님의 도를 따랐음을 고백합니다(21-51절). 이 노래는 개인의 간증을 넘어, 하나님의 백성을 향한 구원의 확실성과 주권을 선포하는 위대한 신앙고백입니다.</p>
                
                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>하나님의 주권적 구원과 현현(Theophany):</strong> 다윗은 인간의 힘으로 벗어날 수 없는 절망을 "사망의 줄이 나를 얽고 불의의 창수가 나를 두렵게 하였으며"(5절)라고 묘사합니다. 이 절망적인 부르짖음에 하나님은 창조주로서의 권능으로 응답하십니다. "여호와께서 하늘에서 우렛소리를 내시며 지존하신 자가 음성을 내심이여"(14절)라는 구절은 시내산 언약을 연상시키는 압도적인 임재를 보여주며, 다윗의 구원이 우연이 아닌 하나님의 직접적이고 주권적인 개입임을 증거합니다. 이는 성도의 구원이 전적으로 하나님의 능력과 은혜에 달려있음을 강력하게 보여주는 구속사적 원리입니다.</li>
                    <li><strong>언약에 기초한 공의와 보상:</strong> "여호와께서 내 공의를 따라 상 주시며 내 손의 깨끗함을 따라 갚으셨으니"(21절)라는 고백은 율법주의적 교만이 아닙니다. 이는 하나님과의 언약 관계 안에서 신실하게 행하려는 중심을 하나님께서 인정해주셨다는 믿음의 선언입니다. 다윗은 "내가 여호와의 도를 지키고 악을 행하여 내 하나님을 떠나지 아니하였"(22절)다고 말하며 언약 백성으로서의 정체성을 지키려 노력했음을 강조합니다. 이는 장차 오실 완전한 의인이신 예수 그리스도의 순종을 예표하며, 성도 또한 그리스도 안에서 의롭다 함을 얻고 그분의 뜻을 따를 때 하나님의 신실한 보상을 경험하게 됨을 보여줍니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="OT/OT_09_2SA_22.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="2SA_22" data-title="사무엘하 22장">성경 듣기</button>
                </div>
            </div>

            <div class="chapter-card card-book2">
                <h3>갈라디아서 2장: 오직 믿음으로 말미암는 의</h3>
                <h4>상세 개요</h4>
                <p>갈라디아서 2장에서 바울은 자신이 전한 복음의 사도적 권위와 그 핵심 내용을 강력하게 변증합니다. 그는 예루살렘 방문(1-10절)과 안디옥에서 게바(베드로)를 책망한 사건(11-21절)을 통해 '오직 믿음으로 말미암는 칭의'라는 복음의 진리가 타협할 수 없는 핵심임을 역설합니다. 안디옥에서 베드로가 유대주의자들을 의식하여 이방인 성도들과의 교제를 피하는 위선적인 행동을 하자, 바울은 그를 공개적으로 책망하며 율법의 행위가 아닌 오직 예수 그리스도를 믿음으로 의롭게 됨을 선포합니다. 이 장의 클라이맥스는 "내가 그리스도와 함께 십자가에 못 박혔나니"로 시작하는 바울의 신앙고백(20절)으로, 그리스도와의 연합을 통한 새로운 삶의 원리를 제시합니다.</p>
                
                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>복음의 통일성과 사도적 권위:</strong> 바울은 예루살렘 사도들이 "베드로에게 역사하사 할례자의 사도로 삼으신 이가 또한 내게 역사하사 나를 이방인의 사도로 삼으셨느니라"(8절)는 것을 인정했다고 말하며, 자신의 사도직과 복음이 예루살렘 교회의 그것과 근본적으로 동일함을 강조합니다. 복음은 하나이며, 유대인이나 이방인이나 차별 없이 오직 그리스도를 믿음으로 구원받는다는 진리는 모든 사도들에게 공통된 것이었습니다. 이는 교회의 통일성이 인간적인 합의가 아닌, 동일한 복음의 진리 위에 세워져야 함을 강력하게 시사합니다.</li>
                    <li><strong>율법의 행위와 믿음의 대조:</strong> "사람이 의롭게 되는 것은 율법의 행위로 말미암음이 아니요 오직 예수 그리스도를 믿음으로 말미암는 줄 알므로 우리도 그리스도 예수를 믿나니"(16절)라는 선언은 종교개혁의 핵심 원리를 담고 있습니다. '율법의 행위'는 단순히 도덕법 준수를 넘어, 할례나 정결법 등 유대인으로서의 정체성을 드러내는 모든 종교적 행위를 포함합니다. 바울은 이러한 행위로는 하나님 앞에서 결코 의롭다 함을 얻을 수 없다고 단언하며, 구원이 인간의 노력이 아닌 전적인 하나님의 은혜임을 명확히 합니다.</li>
                    <li><strong>그리스도와의 연합과 새로운 정체성:</strong> "내가 그리스도와 함께 십자가에 못 박혔나니 그런즉 이제는 내가 사는 것이 아니요 오직 내 안에 그리스도께서 사시는 것이라"(20절)는 고백은 칭의를 넘어 성화의 삶으로 나아가는 원리를 보여줍니다. 믿음은 그리스도와 성도를 신비적으로 연합시킵니다. 이 연합을 통해 옛 자아는 죽고, 내주하시는 그리스도의 생명으로 살아가는 새로운 피조물이 됩니다. 이 새로운 삶은 "나를 사랑하사 나를 위하여 자기 자신을 버리신 하나님의 아들을 믿는 믿음 안에서 사는 것"이며, 율법의 강요가 아닌 사랑과 감사의 자발적인 응답입니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="NT/NT_11_GAL_02.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="GAL_2" data-title="갈라디아서 2장">성경 듣기</button>
                </div>
            </div>

            <div class="chapter-card card-book3">
                <h3>에스겔 29장: 교만한 바로에 대한 심판</h3>
                <h4>상세 개요</h4>
                <p>에스겔 29장은 애굽과 그 왕 바로에 대한 하나님의 심판 예언입니다. 하나님은 바로를 나일 강에 누운 '큰 악어'로 비유하시며, 그의 극도의 교만을 지적하십니다. 바로는 "이 나일 강은 내 것이라 내가 나를 위하여 만들었다"(3절)고 말하며 스스로를 신격화합니다. 이 교만 때문에 하나님은 그를 심판하실 것을 선포하십니다. 이 심판의 또 다른 이유는 애굽이 이스라엘에게 신뢰할 수 없는 '갈대 지팡이'와 같았기 때문입니다(6절). 이스라엘이 의지하려 할 때마다 부러져 상처만 입혔던 애굽의 배신은 하나님의 진노를 샀습니다. 결국 애굽 땅은 40년간 황폐해지고, 이후 회복되더라도 다시는 강대국이 되지 못할 것이라는 예언을 통해 오직 여호와만이 참된 주권자이심을 보여줍니다.</p>

                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>창조주를 대적하는 교만:</strong> 바로가 "내가 나를 위하여 만들었다"(3, 9절)고 주장하는 것은 창조주 하나님의 주권에 대한 정면 도전입니다. 고대 애굽에서 바로는 신의 아들이자 생명과 풍요의 근원인 나일 강의 주인으로 숭배받았습니다. 그의 주장은 자신이 생명의 주관자라는 신성모독적 선언입니다. 하나님은 이 교만을 심판하심으로써, 역사의 주관자는 세상의 통치자가 아니라 오직 여호와 한 분뿐이심을 명백히 하십니다. 이는 구속사 전체를 통해 반복되는 주제로, 바벨탑부터 적그리스도까지 하나님을 대적하는 모든 교만한 세력은 반드시 하나님의 심판 아래 무너지게 될 것을 보여줍니다.</li>
                    <li><strong>헛된 의지 대상에 대한 심판:</strong> 하나님은 애굽을 심판하시는 이유로 "그들이 이스라엘 족속에게 갈대 지팡이가 됨이라"(6절)고 지적하십니다. 이스라엘은 위기 때마다 하나님 대신 강대국 애굽을 의지하려 했지만, 애굽은 늘 그들을 실망시키고 더 큰 고통을 안겨주었습니다. 하나님의 심판은 애굽의 교만뿐만 아니라, 하나님의 백성이 하나님 아닌 다른 것을 의지하는 어리석음을 깨우치기 위한 목적도 있습니다. 이는 성도들에게 세상의 힘, 부, 지혜를 의지하지 말고 오직 만군의 여호와만을 피난처로 삼아야 한다는 중요한 영적 교훈을 줍니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="OT/OT_26_EZK_29.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="EZK_29" data-title="에스겔 29장">성경 듣기</button>
                </div>
            </div>

            <div class="chapter-card card-book4">
                <h3>시편 78:1-37절: 언약을 잊은 백성의 반역사</h3>
                <h4>상세 개요</h4>
                <p>시편 78편은 아삽의 마스길(교훈시)로, 이스라엘의 과거 역사를 회고하며 다음 세대에게 신앙의 교훈을 전달합니다. 시인은 서두에서 하나님의 위대한 행적을 다음 세대에게 전해야 할 의무를 강조하며(1-4절), 그 목적이 "그들의 소망을 하나님께 두며 하나님께서 행하신 일을 잊지 아니하고 오직 그의 계명을 지켜서"(7절) 완고한 조상들의 길을 따르지 않게 하려는 것임을 밝힙니다. 이후 시인은 출애굽의 기적과 광야에서의 놀라운 은혜에도 불구하고, 끊임없이 하나님을 시험하고 반역했던 광야 세대의 불신앙을 구체적으로 열거합니다. 그들은 하나님의 능력을 보고도 믿지 않았고(22절), 탐욕으로 하나님을 시험했으며(18절), 약속의 땅 앞에서 하나님의 신실하심을 의심했습니다.</p>
                
                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>신앙 전수의 교육적 사명:</strong> 시편 78편은 신앙 교육의 중요성을 강력하게 역설합니다. 시인은 "이는 우리가 들어서 아는 바요 우리의 조상들이 우리에게 전한 바라 우리가 이를 그들의 자손에게 숨기지 아니하고"(3-4절)라고 말하며, 하나님의 위대한 행적과 언약을 다음 세대에 전달하는 것이 언약 공동체의 핵심 사명임을 분명히 합니다. 이 교육의 목적은 단순한 역사 지식 전달이 아니라, 다음 세대가 소망을 오직 하나님께만 두고 그분의 계명을 지키도록 하는 데 있습니다(7절). 이는 개혁주의 언약 신학에서 강조하는 가정과 교회의 교육적 책무와 정확히 일치합니다.</li>
                    <li><strong>기적을 보고도 믿지 않는 인간의 완악함:</strong> 이 시편은 인간의 죄성이 얼마나 뿌리 깊은지를 적나라하게 보여줍니다. 이스라엘 백성은 홍해를 가르고, 만나와 메추라기를 내리시는 하나님의 기적을 목격하고도 "하나님을 믿지 아니하며 그의 구원을 의지하지 아니하였도다"(22절)라고 기록됩니다. 심지어 "하나님께서 행하신 일과 그들에게 보이신 그의 기이한 일을 잊어버렸도다"(11절)라고 지적합니다. 이는 구원이 단순히 기적을 체험하는 데 있는 것이 아니라, 하나님의 말씀을 믿고 신뢰하는 마음에 있음을 보여줍니다. 인간의 마음은 하나님의 명백한 증거 앞에서도 얼마든지 완고해질 수 있으며, 오직 성령의 주권적인 역사하심만이 참된 믿음을 가능하게 함을 교훈합니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="OT/OT_19_PSA_78.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="PSA_78" data-title="시편 78편">성경 듣기</button>
                </div>
            </div>

            <div class="integration-card">
                <h2>통합 묵상: 구원의 주권과 믿음의 반응</h2>
                <h3>관통하는 주제 논증: 하나님의 절대 주권과 그에 대한 인간의 응답</h3>
                <p>오늘의 네 본문은 서로 다른 시대와 상황 속에서 '하나님의 절대적인 구원의 주권'이라는 하나의 거대한 주제를 향해 수렴합니다. 사무엘하 22장에서 다윗은 자신의 모든 구원이 전적인 하나님의 능력과 개입의 결과임을 노래하며 인간의 힘이 아닌 하나님의 주권을 찬양합니다. 에스겔 29장은 이 주권의 또 다른 측면, 즉 하나님을 대적하는 교만한 세상 권세(애굽의 바로)를 심판하시는 하나님의 통치권을 보여줍니다. 시편 78편은 이러한 하나님의 주권적 구원 역사에도 불구하고, 인간이 얼마나 쉽게 그 은혜를 잊고 불신앙으로 반응하는지를 보여주는 비극적인 기록입니다. 이 세 본문이 제기하는 문제, 즉 '주권적 하나님의 구원을 인간은 어떻게 자신의 것으로 누릴 수 있는가?'에 대한 명확한 답을 갈라디아서 2장이 제시합니다. 바울은 인간의 '율법의 행위'가 아닌, 오직 "나를 사랑하사 나를 위하여 자기 자신을 버리신 하나님의 아들을 믿는 믿음"(갈 2:20)을 통해서만 하나님의 주권적 구원에 참여하고 의롭다 하심을 얻을 수 있음을 선포합니다. 결국 오늘의 본문들은 하나님의 구원은 그분의 절대 주권에 속한 것이며, 인간은 오직 그리스도를 믿는 믿음으로만 그 구원에 동참할 수 있다는 구속사의 핵심 진리를 다각적으로 조명하고 있습니다.</p>

                <h3>입체적 핵심 단어 연구: δικαιοσύνη (디카이오쉬네, 의)</h3>
                <p>갈라디아서 2장 16절의 핵심 단어인 헬라어 '디카이오쉬네'(δικαιοσύνη)는 '의, 의로움, 올바름' 등으로 번역되며 신약성경, 특히 바울 신학의 심장과도 같은 개념입니다. 구약의 히브리어 '체데크'(צֶדֶק)에 뿌리를 둔 이 단어는 단순히 윤리적 올바름을 넘어, '언약 관계 안에서의 신실함과 올바른 상태'를 의미합니다. 하나님께 이 단어가 사용될 때는, 당신의 언약 백성을 구원하시고 악을 심판하시는 하나님의 신실하고 공의로운 성품을 나타냅니다. 바울은 이 '의'가 인간의 율법 준수라는 행위(ἔργων νόμου)를 통해서는 결코 얻을 수 없다고 단언합니다. 바울이 제시하는 해답은 '예수 그리스도를 믿는 믿음으로 말미암는 의'(διὰ πίστεως Ἰησοῦ Χριστοῦ)입니다. 이는 하나님께서 그리스도의 십자가 순종을 보시고, 그를 믿는 자에게 그리스도의 완전한 의를 전가시켜 주시는 법정적 행위입니다. 즉, 죄인인 우리가 스스로 의로워지는 것이 아니라, 그리스도의 의를 덧입어 하나님 앞에서 '의롭다'고 선언받는 것입니다. 이 '디카이오쉬네'의 이해는 인간의 공로를 완전히 배제하고 오직 하나님의 은혜와 그리스도의 공로만을 높이는 복음의 정수입니다.</p>
                
                <h3>심층 상호 참조</h3>
                <ul>
                    <li><strong>사무엘하 22:2-3 & 갈라디아서 2:20:</strong> 다윗은 "여호와는 나의 반석이시요 나의 요새시요 나를 위하여 나를 건지시는 자시요"라고 고백하며 하나님을 구원의 유일한 근거로 선포합니다. 이 구약적 신앙고백은 신약에서 바울이 "나를 사랑하사 나를 위하여 자기 자신을 버리신 하나님의 아들을 믿는 믿음 안에서 사는 것이라"고 고백하는 것과 깊이 연결됩니다. 다윗이 의지했던 '반석'이신 하나님이, 바로 십자가에서 자신을 내어주신 예수 그리스도를 통해 구체적으로 계시된 것입니다.</li>
                    <li><strong>에스겔 29:6-7 & 시편 78:22:</strong> 하나님은 애굽을 "이스라엘 족속에게 갈대 지팡이"와 같았다고 책망하십니다. 이스라엘이 의지하려 할 때마다 부러져 상처만 입혔다는 것입니다. 이는 시편 78편에서 이스라엘이 하나님의 능력을 보고도 "하나님을 믿지 아니하며 그의 구원을 의지하지 아니한"(시 78:22) 죄와 본질적으로 같습니다. 두 본문 모두 참된 반석이신 하나님을 버리고 부러질 갈대를 의지하는 인간의 어리석음을 고발합니다.</li>
                </ul>

                <h3>적용을 위한 성찰 질문</h3>
                <ol>
                    <li>다윗은 인생의 가장 큰 위기 속에서 하나님을 '나의 반석', '나의 요새'라고 고백했습니다. 당신의 삶에서 가장 흔들리는 영역은 무엇이며, 그 영역에서 하나님을 당신의 유일한 반석으로 신뢰하기 위해 구체적으로 무엇을 결단해야 합니까?</li>
                    <li>바울은 베드로의 위선을 공개적으로 책망할 만큼 복음의 진리(오직 믿음으로 말미암는 의)에 타협이 없었습니다. 당신의 삶 속에서 사람들의 시선이나 인정을 의식하여 복음의 원리를 타협하고 있는 부분은 없습니까?</li>
                    <li>하나님은 이스라엘이 의지했던 애굽을 심판하셨습니다. 당신이 하나님보다 더 의지하고 안정감을 느끼는 '갈대 지팡이'(재물, 인간관계, 능력 등)는 무엇입니까? 그것이 무너질 때에도 여전히 하나님을 신뢰할 수 있겠습니까?</li>
                    <li>시편 78편은 과거의 실패를 교훈 삼아 다음 세대를 가르치라고 명령합니다. 당신이 경험한 신앙의 실패와 그 속에서 깨달은 하나님의 은혜를 어떻게 당신의 자녀나 다음 세대에게 진솔하게 나누어 줄 수 있을까요?</li>
                </ol>
            </div>
        </main>

        <footer>
            <p>© 2025 KBD 맥체인 성경읽기 프로젝트</p>
        </footer>
    </div>

    <div id="bible-modal" class="modal">
        <div class="modal-content">
            <div class="modal-body" id="modal-body-content"><div class="spinner"></div></div>
        </div>
    </div>

    <div id="audio-player" class="audio-player">
        <div class="audio-player-info" id="player-info"></div>
        <div class="audio-player-controls">
            <button id="play-pause-btn">▶</button>
            <button id="close-player-btn">✖</button>
        </div>
    </div>
    <div id="youtube-player-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainContainer = document.getElementById('main-container');
            const bibleModal = document.getElementById('bible-modal');
            const modalBody = document.getElementById('modal-body-content');
            const audioPlayerBar = document.getElementById('audio-player');
            const playerInfo = document.getElementById('player-info');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const closePlayerBtn = document.getElementById('close-player-btn');
            
            let ytPlayer;
            let audioLinks = new Map();
            let isPlayerReady = false;

            // 1. Load YouTube IFrame API
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            window.onYouTubeIframeAPIReady = function() {
                ytPlayer = new YT.Player('youtube-player-container', {
                    height: '0',
                    width: '0',
                    events: {
                        'onReady': () => { isPlayerReady = true; },
                        'onStateChange': (event) => {
                            playPauseBtn.innerHTML = (event.data === YT.PlayerState.PLAYING) ? '❚❚' : '▶';
                        }
                    }
                });
            }

            // 2. Fetch and parse mcbible.txt with CORRECTED key parsing logic
            async function loadAudioLinks() {
                try {
                    const response = await fetch('../address/mcbible.txt');
                    if (!response.ok) throw new Error('오디오 목록 파일을 불러올 수 없습니다.');
                    const text = await response.text();
                    text.split('\n').forEach(line => {
                        if (line.trim() !== '') {
                            const parts = line.split(/\s+/);
                            const fullKey = parts[0];
                            const url = parts[1];
                            const keyParts = fullKey.split('_'); 
                            
                            // *** THIS IS THE CRITICAL FIX ***
                            // Check if the key has at least 3 parts (e.g., [OT, 09, 2SA, 22] or [NT, 11, GAL, 02])
                            if (keyParts.length >= 3) {
                                const book = keyParts[2];
                                const chapter = parseInt(keyParts.at(-1), 10);
                                const shortKey = `${book}_${chapter}`;
                                audioLinks.set(shortKey, url);
                            }
                        }
                    });
                } catch (error) {
                    console.error('오디오 링크 로딩 오류:', error);
                }
            }
            
            function getYouTubeID(url) {
                const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            // 3. Event Delegation for all buttons
            mainContainer.addEventListener('click', async (e) => {
                const target = e.target.closest('.btn');
                if (!target) return;

                // Handle "본문 보기"
                if (target.classList.contains('btn-view')) {
                    const path = target.dataset.path;
                    bibleModal.style.display = 'block';
                    modalBody.innerHTML = '<div class="spinner"></div>';
                    try {
                        const response = await fetch(`../bible_html/${path}`);
                        if (!response.ok) throw new Error(`HTTP 오류! 상태: ${response.status}`);
                        const html = await response.text();
                        modalBody.innerHTML = html;
                    } catch (error) {
                        modalBody.innerHTML = `<p>본문을 불러오는 데 실패했습니다: ${error.message}</p>`;
                    }
                }
                
                // Handle "성경 듣기"
                if (target.classList.contains('btn-listen')) {
                    if (!isPlayerReady) {
                        alert('오디오 플레이어가 아직 준비되지 않았습니다.');
                        return;
                    }
                    if (audioLinks.size === 0) {
                        await loadAudioLinks(); 
                         if (audioLinks.size === 0) {
                            alert('오디오 목록을 불러오지 못했습니다. 파일 경로와 서버 상태를 확인해주세요.');
                            return;
                        }
                    }
                    const key = target.dataset.key;
                    const title = target.dataset.title;
                    const url = audioLinks.get(key);

                    if (url) {
                        const videoId = getYouTubeID(url);
                        if (videoId) {
                            ytPlayer.loadVideoById(videoId);
                            playerInfo.textContent = `재생중: ${title}`;
                            audioPlayerBar.classList.add('show');
                        } else {
                            alert(`'${title}'의 YouTube 영상 ID를 추출할 수 없습니다.`);
                        }
                    } else {
                        alert(`'${title}'에 해당하는 오디오를 찾을 수 없습니다. (Key: ${key})`);
                    }
                }
            });

            // 4. Modal and Player Controls
            bibleModal.addEventListener('click', (e) => {
                if (e.target === bibleModal) {
                    bibleModal.style.display = 'none';
                }
            });

            playPauseBtn.addEventListener('click', () => {
                if (!ytPlayer || typeof ytPlayer.getPlayerState !== 'function') return;
                const playerState = ytPlayer.getPlayerState();
                if (playerState === YT.PlayerState.PLAYING) {
                    ytPlayer.pauseVideo();
                } else {
                    ytPlayer.playVideo();
                }
            });

            closePlayerBtn.addEventListener('click', () => {
                if (ytPlayer && typeof ytPlayer.stopVideo === 'function') {
                    ytPlayer.stopVideo();
                }
                audioPlayerBar.classList.remove('show');
            });
            
            // Initial load
            loadAudioLinks();
        });
    </script>
</body>
</html>
