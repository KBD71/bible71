<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9월 28일 맥체인 성경읽기</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=KoPub+Batang:wght@400;700&family=Pretendard:wght@400;600;700&display=swap');

        :root {
            --font-main: 'KoPub Batang', serif;
            --font-heading: 'Pretendard', sans-serif;
            --color-text: #343a40;
            --color-background: #f8f9fa;
            --color-card-bg: #ffffff;
            --color-border: #dee2e6;
            --color-muted: #868e96;
            --book1-color: #4285F4;
            --book2-color: #DB4437;
            --book3-color: #c89200;
            --book4-color: #0F9D58;
            --integration-color: #5f6368;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-main);
            font-size: 17px;
            line-height: 1.8;
            color: var(--color-text);
            background-color: var(--color-background);
            margin: 0;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
        }

        .container { width: 100%; max-width: 1280px; }
        .content-wrapper { max-width: 800px; margin: 0 auto; }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 1.5rem;
        }
        header h1 { font-family: var(--font-heading); font-size: 2.5rem; font-weight: 700; }
        header h4 { font-family: var(--font-heading); font-size: 0.9rem; color: var(--color-muted); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; margin-top: 0; }

        .chapter-card, .integration-card {
            background-color: var(--color-card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            border-left: 8px solid;
            transition: all 0.3s ease;
            padding: 2rem;
        }
        .chapter-card:hover, .integration-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .card-book1 { border-color: var(--book1-color); } .card-book1 h3 { color: var(--book1-color); }
        .card-book2 { border-color: var(--book2-color); } .card-book2 h3 { color: var(--book2-color); }
        .card-book3 { border-color: var(--book3-color); } .card-book3 h3 { color: var(--book3-color); }
        .card-book4 { border-color: var(--book4-color); } .card-book4 h3 { color: var(--book4-color); }
        .integration-card { border-color: var(--integration-color); } .integration-card h3 { color: var(--integration-color); }

        h3 { font-family: var(--font-heading); font-size: 1.8rem; font-weight: 700; margin-top: 0; margin-bottom: 1.5rem; }
        h4 { font-family: var(--font-heading); font-size: 1.1rem; color: var(--color-text); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid var(--color-border); padding-bottom: 0.5rem; margin-top: 2.5rem; margin-bottom: 1.5rem; }
        p { margin-top: 0; margin-bottom: 1.5em; }

        .btn-group { margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap; }
        .btn { font-family: var(--font-heading); padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; transition: all 0.3s ease; text-decoration: none; display: inline-block; color: white; }
        .btn-view { background-color: #495057; } .btn-view:hover { background-color: #212529; }
        .btn-listen { background-color: var(--integration-color); } .btn-listen:hover { background-color: #343a40; }
        .btn:hover { transform: translateY(-2px); }

        .modal-overlay { display: none; position: fixed; z-index: 1050; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.3s; }
        .modal-content { background-color: var(--color-card-bg); margin: 5% auto; padding: 30px; border-radius: 10px; width: 80%; max-width: 800px; position: relative; animation: slideIn 0.3s; }
        .modal-close-btn { position: absolute; top: 15px; right: 25px; font-size: 2rem; font-weight: bold; color: #aaa; cursor: pointer; transition: color 0.3s ease; }
        .modal-close-btn:hover { color: #333; }
        .modal-body { max-height: 70vh; overflow-y: auto; font-size: 18px; line-height: 2; }
        .spinner { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 100px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { translateY(0); opacity: 1; } }

        .audio-player { position: fixed; bottom: -100px; left: 0; width: 100%; background-color: rgba(30, 40, 50, 0.9); backdrop-filter: blur(10px); color: white; padding: 12px 20px; box-shadow: 0 -2px 15px rgba(0,0,0,0.2); z-index: 1051; display: flex; justify-content: center; align-items: center; transition: bottom 0.4s ease-in-out; box-sizing: border-box;}
        .audio-player.visible { bottom: 0; }
        .audio-player-content { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 800px; }
        .audio-player-info { font-family: var(--font-heading); font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .audio-player-controls { display: flex; align-items: center; gap: 15px; }
        .audio-player-controls button { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; transition: color 0.2s; padding: 5px;}
        .audio-player-controls button:hover { color: #a7b3c0; }
        #player-container { display: none; }

        footer { text-align: center; margin-top: 4rem; padding: 2rem 0; border-top: 1px solid var(--color-border); color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h4>M'Cheyne Bible Reading Plan</h4>
            <h1>9월 28일</h1>
        </header>

        <main>
            <article class="chapter-card card-book1">
                <h3>사무엘하 24장: 다윗의 인구조사와 하나님의 징계</h3>
                <h4>상세 개요</h4>
                <p>사무엘하 24장은 다윗의 통치 말년에 있었던 심각한 범죄와 그로 인한 하나님의 징계를 기록합니다. 하나님께서 이스라엘을 향해 진노하사, 다윗의 마음을 격동시켜 이스라엘과 유다의 인구를 계수하게 하십니다. 군사령관 요압의 강력한 반대에도 불구하고 다윗은 인구 조사를 강행합니다. 조사를 마친 후 다윗은 자신의 죄를 깨닫고 회개하지만, 하나님께서는 선지자 갓을 통해 세 가지 재앙 중 하나를 택하라고 하십니다. 다윗은 하나님의 긍휼에 자신을 맡기며 전염병을 택하고, 이로 인해 이스라엘 백성 칠만 명이 죽습니다. 재앙이 예루살렘에 이르려 할 때, 하나님께서 뜻을 돌이키시고, 다윗은 아라우나(오르난)의 타작마당에서 제단을 쌓고 번제와 화목제를 드림으로써 재앙이 그치게 됩니다. 이 장소는 훗날 솔로몬 성전이 세워지는 중요한 곳이 됩니다.</p>
                <div class="btn-group">
                    <button class="btn btn-view" data-path="https://kbd71.github.io/bible71/bible_html/OT/OT_10_2SA_24.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="2SA_24" data-title="사무엘하 24장">성경 듣기</button>
                </div>
            </article>

            <article class="chapter-card card-book2">
                <h3>갈라디아서 4장: 종에서 아들로, 유업을 이을 자</h3>
                <h4>상세 개요</h4>
                <p>갈라디아서 4장에서 바울은 율법 아래 있는 상태를 '종' 또는 '어린 아이'의 상태에 비유합니다. 유업을 이을 자라도 어렸을 동안에는 후견인과 청지기 아래 있어 종과 다름이 없듯이, 우리도 율법이라는 '초등학문' 아래 종 노릇 했다는 것입니다. 그러나 "때가 차매 하나님이 그 아들을 보내사 여자에게서 나게 하시고 율법 아래에 나게 하신 것은 율법 아래에 있는 자들을 속량하시고 우리로 아들의 명분을 얻게 하려 하심이라"(4-5절)고 선포합니다. 이제 우리는 종이 아니라 하나님의 아들이 되었으며, 성령께서 우리 마음 가운데 오셔서 하나님을 "아빠 아버지"라 부르게 하십니다. 아들이 되었기에 우리는 하나님의 유업을 이을 자가 되었습니다. 바울은 이러한 자유를 얻은 갈라디아 교인들이 다시 율법의 절기나 규례 같은 '약하고 천박한 초등학문'으로 돌아가려는 것을 강하게 책망하며, 사라와 하갈의 비유를 통해 율법을 따르는 자는 종의 자녀이며, 약속을 믿는 자만이 자유인의 자녀, 즉 아브라함의 참된 상속자임을 논증합니다.</p>
                <div class="btn-group">
                    <button class="btn btn-view" data-path="https://kbd71.github.io/bible71/bible_html/NT/NT_48_GAL_04.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="GAL_4" data-title="갈라디아서 4장">성경 듣기</button>
                </div>
            </article>
            
            <article class="chapter-card card-book3">
                <h3>에스겔 31장: 앗수르의 교만과 몰락</h3>
                <h4>상세 개요</h4>
                <p>에스겔 31장은 애굽 왕 바로에게 주는 경고의 메시지로, 과거 강대했던 앗수르 제국의 교만과 그 비참한 몰락을 비유로 설명합니다. 앗수르는 레바논의 백향목에 비유되는데, 그 키가 크고 가지가 아름다워 모든 나무 위에 뛰어났으며, 많은 민족이 그 그늘 아래 거했습니다. 그의 강대함의 근원은 "물이 많으므로"(7절) 였지만, 그는 그 영광으로 인해 "마음이 교만하여졌습니다"(10절). 이 교만 때문에 하나님께서는 그를 "여러 나라의 능한 자의 손에 넘겨주실"(11절) 것이며, 결국 그는 베임을 당해 구덩이(스올)에 내려가는 모든 자들과 함께 비참한 최후를 맞이하게 될 것이라고 선포합니다. 이 앗수르의 운명은 곧 애굽 왕 바로가 맞이하게 될 미래이며, 세상의 어떤 강대한 권세도 하나님의 심판을 피할 수 없음을 강력하게 경고하는 메시지입니다.</p>
                <div class="btn-group">
                    <button class="btn btn-view" data-path="https://kbd71.github.io/bible71/bible_html/OT/OT_26_EZE_31.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="EZE_31" data-title="에스겔 31장">성경 듣기</button>
                </div>
            </article>

            <article class="chapter-card card-book4">
                <h3>시편 79편: 파괴된 성전을 위한 탄식</h3>
                <h4>상세 개요</h4>
                <p>시편 79편은 아삽의 시로, 이방 민족에 의해 예루살렘이 짓밟히고 성전이 더럽혀지며, 수많은 백성이 학살당한 국가적 참사를 배경으로 하는 공동체의 탄식시입니다. 시인은 "하나님이여 이방 나라들이 주의 기업의 땅에 들어와서 주의 성전을 더럽히고 예루살렘이 돌무더기가 되게 하였나이다"(1절)라고 비통하게 부르짖습니다. 주의 종들의 시체가 공중의 새와 들짐승의 밥이 되고, 그들의 피가 예루살렘 사방에 물 같이 흘렀으나 장사 지내주는 이조차 없는 참상을 고발합니다. 이 모든 재앙의 원인이 자신들의 죄 때문임을 인정하면서도, 시인은 하나님의 긍휼을 구하며 "주의 이름의 영광을 위하여 우리를 도우시며 주의 이름을 증거하기 위하여 우리를 건지시며 우리 죄를 사하소서"(9절)라고 간구합니다. 그는 이방인들이 "그들의 하나님이 어디 있느냐"고 조롱하는 상황 속에서, 하나님의 명예 회복을 위해 원수들에게 복수해 주실 것을 요청하며 기도를 마칩니다.</p>
                <div class="btn-group">
                    <button class="btn btn-view" data-path="https://kbd71.github.io/bible71/bible_html/OT/OT_19_PSA_79.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="PSA_79" data-title="시편 79편">성경 듣기</button>
                </div>
            </article>
        </main>

        <footer>
            <p>© 2025 KBD 맥체인 성경읽기 프로젝트</p>
        </footer>
    </div>

    <div id="bible-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div id="modal-body-content" class="modal-body"><div class="spinner"></div></div>
        </div>
    </div>

    <div id="audio-player" class="audio-player">
        <div class="audio-player-content">
            <div class="audio-player-info" id="player-info"></div>
            <div class="audio-player-controls">
                <button id="play-pause-btn">▶</button>
                <button id="close-player-btn">✖</button>
            </div>
        </div>
    </div>
    <div id="player-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audioKeyMap = new Map();
            let ytPlayer, isPlayerReady = false;

            const modal = {
                overlay: document.getElementById('bible-modal'),
                body: document.getElementById('modal-body-content'),
                closeBtn: document.querySelector('.modal-close-btn')
            };

            const audioPlayer = {
                bar: document.getElementById('audio-player'),
                info: document.getElementById('player-info'),
                playPauseBtn: document.getElementById('play-pause-btn'),
                closeBtn: document.getElementById('close-player-btn')
            };

            function initYouTubeAPI() {
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                window.onYouTubeIframeAPIReady = function() {
                    ytPlayer = new YT.Player('player-container', {
                        height: '0', width: '0',
                        playerVars: { 'autoplay': 1, 'controls': 0, 'rel': 0, 'fs': 0 },
                        events: {
                            'onReady': () => { isPlayerReady = true; },
                            'onStateChange': (event) => {
                                audioPlayer.playPauseBtn.innerHTML = (event.data === YT.PlayerState.PLAYING) ? '❚❚' : '▶';
                            }
                        }
                    });
                };
            }

            async function loadAudioKeys() {
                try {
                    const response = await fetch('https://kbd71.github.io/bible71/address/mcbible.txt');
                    if (!response.ok) throw new Error('오디오 목록 파일을 불러올 수 없습니다.');
                    const text = await response.text();
                    text.split('\n').forEach(line => {
                        if (line.trim()) {
                            const parts = line.trim().split(/\s+/);
                            const longKey = parts[0];
                            const url = parts[1];
                            if (longKey && url) {
                                const keyParts = longKey.split('_');
                                if (keyParts.length >= 3) {
                                    const book = keyParts[2];
                                    const chapter = parseInt(keyParts.at(-1), 10);
                                    const shortKey = `${book}_${chapter}`;
                                    audioKeyMap.set(shortKey, url);
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.error('오디오 링크 로딩 오류:', error);
                }
            }
            
            function getYouTubeID(url) {
                const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            document.querySelector('main').addEventListener('click', async (e) => {
                const target = e.target.closest('.btn');
                if (!target) return;

                if (target.classList.contains('btn-view')) {
                    const path = target.dataset.path;
                    modal.overlay.style.display = 'block';
                    modal.body.innerHTML = '<div class="spinner"></div>';
                    try {
                        const response = await fetch(path);
                        if (!response.ok) throw new Error(`HTTP 오류! 상태: ${response.status}`);
                        const html = await response.text();
                        modal.body.innerHTML = html;
                    } catch (error) {
                        modal.body.innerHTML = `<p>본문을 불러오는 데 실패했습니다: ${error.message}</p>`;
                    }
                }
                
                if (target.classList.contains('btn-listen')) {
                    if (!isPlayerReady) { alert('오디오 플레이어가 아직 준비되지 않았습니다.'); return; }
                    if (audioKeyMap.size === 0) {
                         alert('오디오 목록을 불러오지 못했습니다. 파일 경로와 서버 상태를 확인해주세요.');
                         return;
                    }

                    const key = target.dataset.key;
                    const title = target.dataset.title;
                    const url = audioKeyMap.get(key);

                    if (url) {
                        const videoId = getYouTubeID(url);
                        if (videoId) {
                            ytPlayer.loadVideoById(videoId);
                            audioPlayer.info.textContent = `재생 중: ${title}`;
                            audioPlayer.bar.classList.add('visible');
                        } else {
                            alert(`'${title}'의 YouTube 영상 ID를 추출할 수 없습니다.`);
                        }
                    } else {
                        alert(`'${title}'에 해당하는 오디오를 찾을 수 없습니다. (Key: ${key})`);
                    }
                }
            });

            function closeModal() {
                modal.overlay.style.display = 'none';
                modal.body.innerHTML = '';
            }

            modal.closeBtn.addEventListener('click', closeModal);
            modal.overlay.addEventListener('click', (e) => {
                if (e.target === modal.overlay) closeModal();
            });

            audioPlayer.playPauseBtn.addEventListener('click', () => {
                if (!ytPlayer || typeof ytPlayer.getPlayerState !== 'function') return;
                const playerState = ytPlayer.getPlayerState();
                if (playerState === YT.PlayerState.PLAYING) {
                    ytPlayer.pauseVideo();
                } else {
                    ytPlayer.playVideo();
                }
            });

            audioPlayer.closeBtn.addEventListener('click', () => {
                if (ytPlayer && typeof ytPlayer.stopVideo === 'function') {
                    ytPlayer.stopVideo();
                }
                audioPlayer.bar.classList.remove('visible');
            });
            
            initYouTubeAPI();
            loadAudioKeys();
        });
    </script>
</body>
</html>
