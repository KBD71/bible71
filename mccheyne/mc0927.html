<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9월 27일 - 맥체인 성경읽기</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=KoPub+Batang:wght@400;700&family=Pretendard:wght@400;700&display=swap');

        :root {
            --font-serif: 'KoPub Batang', serif;
            --font-sans-serif: 'Pretendard', sans-serif;
            
            --color-text: #212529;
            --color-background: #f8f9fa;
            --color-card-bg: #ffffff;
            --color-border: #dee2e6;

            --color-book1: #4285F4;
            --color-book2: #DB4437;
            --color-book3: #c89200;
            --color-book4: #0F9D58;
            --color-integration: #5f6368;

            --spacing-unit: 1rem;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-serif);
            font-size: 17px;
            line-height: 1.8;
            color: var(--color-text);
            background-color: var(--color-background);
            margin: 0;
            padding: var(--spacing-unit);
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1280px;
            padding: 0 var(--spacing-unit);
        }

        header {
            text-align: center;
            margin-bottom: calc(var(--spacing-unit) * 3);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--spacing-unit);
        }

        h1 {
            font-family: var(--font-sans-serif);
            font-size: clamp(2rem, 5vw, 2.8rem);
            font-weight: 700;
            margin: 0.5em 0;
        }
        
        h2 {
            font-family: var(--font-sans-serif);
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            margin-top: calc(var(--spacing-unit) * 3);
            margin-bottom: var(--spacing-unit);
            border-bottom: 2px solid var(--color-border);
            padding-bottom: calc(var(--spacing-unit) * 0.5);
        }
        
        h3 {
            font-family: var(--font-sans-serif);
            font-size: 1.3rem;
            font-weight: 700;
        }

        .chapter-card, .integration-card {
            background-color: var(--color-card-bg);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: calc(var(--spacing-unit) * 2.5);
            padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 2);
            border-left: 8px solid;
        }
        
        .card-book1 { border-color: var(--color-book1); }
        .card-book1 h3 { color: var(--color-book1); }
        .card-book2 { border-color: var(--color-book2); }
        .card-book2 h3 { color: var(--color-book2); }
        .card-book3 { border-color: var(--color-book3); }
        .card-book3 h3 { color: var(--color-book3); }
        .card-book4 { border-color: var(--color-book4); }
        .card-book4 h3 { color: var(--color-book4); }
        .integration-card { border-color: var(--color-integration); }
        .integration-card h3 { color: var(--color-integration); }

        .btn-group {
            margin-top: calc(var(--spacing-unit) * 1.5);
            display: flex;
            gap: var(--spacing-unit);
            flex-wrap: wrap;
        }

        .btn {
            font-family: var(--font-sans-serif);
            padding: 0.6em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            display: inline-block;
            color: white;
        }

        .btn-view { background-color: #343a40; }
        .btn-listen { background-color: var(--color-integration); }

        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.15);
        }
        .btn:active {
            transform: translateY(0);
            filter: brightness(0.95);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: var(--color-card-bg);
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            position: relative;
            animation: slideIn 0.3s;
        }
        
        .modal-body {
             max-height: 70vh;
             overflow-y: auto;
             font-size: 18px;
             line-height: 2;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 100px auto;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { translateY(0); opacity: 1; } }

        .audio-player {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 500px;
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: bottom 0.3s ease-in-out;
            z-index: 1001;
        }
        .audio-player.show { bottom: 0; }
        .audio-player-info { font-family: var(--font-sans-serif); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .audio-player-controls button { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; margin-left: 15px; }
        .audio-player-controls button:hover { color: #bdc3c7; }
        #youtube-player-container { display: none; }

        footer {
            text-align: center;
            margin-top: calc(var(--spacing-unit) * 4);
            padding: calc(var(--spacing-unit) * 2) 0;
            border-top: 1px solid var(--color-border);
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <header>
            <h1>9월 27일</h1>
            <p>언약의 약속과 인간의 응답</p>
        </header>

        <main>
            <div class="chapter-card card-book1">
                <h3>사무엘하 23장: 다윗의 마지막 말과 용사들의 이름</h3>
                <h4>상세 개요</h4>
                <p>사무엘하 23장은 두 부분으로 구성됩니다. 첫 번째 부분(1-7절)은 다윗의 마지막 말, 즉 그의 유언적 신앙고백을 담고 있습니다. 다윗은 자신의 왕권이 "야곱의 하나님께로부터 기름 부음 받은 자"(1절)로서 하나님께로부터 왔음을 분명히 하며, 의로 다스리는 통치자가 아침 빛과 같다고 노래합니다. 그는 자신의 집이 하나님 앞에서 온전치 못함을 인정하면서도, 하나님께서 자신과 맺으신 '영원한 언약'으로 인해 구원과 소원이 이루어질 것을 확신합니다. 두 번째 부분(8-39절)은 다윗과 함께 했던 용사들의 명단과 그들의 공적을 기록하며, 그의 위대한 왕국이 수많은 충성스러운 헌신 위에 세워졌음을 보여줍니다.</p>
                
                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>다윗 언약의 확신과 메시아 예표:</strong> 다윗은 자신의 마지막 말에서 "내 집이 하나님 앞에 이같이 온전하지 못하냐 하나님이 나와 더불어 영원한 언약을 세우사 만사에 구비하고 견고하게 하셨으니"(5절)라고 고백합니다. 이는 자신의 불완전함에도 불구하고, 하나님의 일방적이고 은혜로운 언약 때문에 자신의 왕조가 영원히 견고할 것임을 믿는 위대한 신앙입니다. 이 '영원한 언약'(삼하 7장)은 구속사적으로 다윗의 자손으로 오실 완전한 왕, 예수 그리스도를 통해 성취됩니다. 다윗이 노래한 "하나님을 경외함으로 다스리는 자여 그는 돋는 해의 아침 빛 같고"(3-4절)라는 이상적인 통치자의 모습은 바로 메시아이신 그리스도의 통치를 예표하는 것입니다.</li>
                    <li><strong>왕국을 세우는 공동체의 헌신:</strong> 용사들의 명단은 다윗 왕국이 다윗 한 사람의 능력으로 세워진 것이 아님을 보여줍니다. 목숨을 걸고 블레셋의 칼날을 뚫고 물을 길어 온 용사들의 이야기는 왕을 향한 그들의 지극한 충성과 사랑을 보여줍니다. 이는 신약의 교회 공동체를 예표합니다. 왕이신 그리스도를 중심으로 모인 성도들이 각자의 은사와 자리에서 충성스럽게 헌신할 때, 하나님의 나라가 견고하게 세워져 감을 보여주는 그림입니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="OT/OT_10_2SA_23.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="2SA_23" data-title="사무엘하 23장">성경 듣기</button>
                </div>
            </div>

            <div class="chapter-card card-book2">
                <h3>갈라디아서 3장: 율법과 약속, 믿음의 역할</h3>
                <h4>상세 개요</h4>
                <p>갈라디아서 3장에서 바울은 "어리석도다 갈라디아 사람들아"라는 강한 질책으로 시작하며, 그들이 어떻게 성령으로 시작했다가 육체(율법의 행위)로 마치려 하는지를 책망합니다. 그는 복음의 핵심 진리를 변증하기 위해 구약의 아브라함을 예로 듭니다. 아브라함이 의롭다 하심을 얻은 것은 율법의 행위가 아니라 하나님을 '믿음'으로써였습니다(6절). 따라서 진정한 아브라함의 자손은 혈통적 유대인이 아니라, 아브라함처럼 믿음으로 사는 모든 사람입니다. 바울은 율법이 약속보다 430년 후에 주어진 것으로, 하나님의 약속을 폐할 수 없다고 논증합니다. 율법의 역할은 우리를 저주 아래 가두고 죄를 깨닫게 하여, 우리를 그리스도께로 인도하는 '몽학선생'(초등교사)의 역할을 하는 것이었습니다. 이제 그리스도께서 오셨으므로, 우리는 더 이상 몽학선생 아래 있지 않고, 믿음으로 말미암아 그리스도 예수 안에서 하나님의 아들이 되었다고 선포합니다.</p>
                
                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>아브라함 언약과 이신칭의:</strong> 바울 신학의 핵심인 '이신칭의' 교리가 아브라함의 예(창 15:6)를 통해 강력하게 논증됩니다. "아브라함이 하나님을 믿으매 그것을 그에게 의로 정하셨다"(6절)는 구절을 인용하여, 구원의 원리가 율법 이전부터 '믿음'이었음을 밝힙니다. 이는 구원이 인간의 행위가 아닌, 하나님의 약속을 믿는 믿음에 대한 하나님의 주권적 선언임을 보여줍니다. 더 나아가 "모든 이방인이 너로 말미암아 복을 받으리라"(8절)는 아브라함 언약을 인용하여, 이신칭의의 복음이 처음부터 모든 민족을 향한 것이었음을 드러냅니다.</li>
                    <li><strong>율법의 목적과 한계:</strong> 바울은 율법의 정확한 위치와 목적을 설명합니다. 율법은 "범법하므로 더하여진 것"(19절)으로, 죄를 죄 되게 드러내어 인간의 비참함을 깨닫게 하는 역할을 합니다. 또한, 율법은 우리를 "그리스도께로 인도하는 초등교사(몽학선생)"(24절)가 되어, 우리 스스로는 구원에 이를 수 없음을 알고 오직 그리스도만을 의지하게 만듭니다. "그리스도께서 우리를 위하여 저주를 받은 바 되사 율법의 저주에서 우리를 속량하셨"(13절)기에, 이제 믿음으로 그리스도와 연합한 자는 율법의 정죄에서 해방되어 약속의 상속자가 됩니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="NT/NT_48_GAL_03.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="GAL_3" data-title="갈라디아서 3장">성경 듣기</button>
                </div>
            </div>

            <div class="chapter-card card-book3">
                <h3>에스겔 30장: 애굽과 그 동맹국들에 임할 여호와의 날</h3>
                <h4>상세 개요</h4>
                <p>에스겔 30장은 29장에 이어 애굽에 대한 심판 예언을 이어갑니다. "여호와의 날", 즉 심판의 날이 가까웠음을 선포하며 애굽뿐만 아니라 그와 동맹을 맺은 모든 민족까지 함께 멸망할 것을 예언합니다. 하나님의 심판은 애굽 전역에 미칠 것이며, 그 땅은 40년간 황폐하게 될 것입니다. 특히 하나님께서는 바벨론 왕 느부갓네살을 심판의 도구로 사용하실 것을 명확히 밝히십니다. 하나님은 "내가 애굽 왕 바로의 팔을 꺾고"(21절) "바벨론 왕의 팔은 견고하게"(24절) 하여, 그를 통해 애굽의 교만을 심판하실 것입니다. 이 모든 심판을 통해 열방은 "내가 여호와인 줄을 알게 될 것"(26절)이라고 선포하십니다.</p>

                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>심판의 도구로서의 세상 권세:</strong> 하나님께서는 애굽을 심판하시기 위해 "바벨론의 왕 느부갓네살의 손에 넘"(10절)기실 것이라고 말씀하십니다. 이방 왕인 느부갓네살이 하나님의 심판 계획을 성취하는 도구로 사용되는 것은 하나님의 절대 주권을 명백하게 보여줍니다. 하나님은 당신의 백성뿐만 아니라, 열방의 역사까지도 당신의 뜻대로 주관하십니다. 이는 성도들에게 세상의 권세나 역사의 흐름을 두려워할 것이 아니라, 그 모든 것 위에 계셔서 당신의 선한 뜻을 이루어 가시는 하나님을 신뢰해야 함을 가르칩니다.</li>
                    <li><strong>'여호와의 날'의 보편적 심판:</strong> 본문은 심판이 애굽에만 국한되지 않고 "구스와 붓과 룻과 모든 섞인 민족과 굽과 및 동맹한 땅의 백성들"(5절)에게까지 미칠 것을 선포합니다. '여호와의 날'은 하나님의 거룩과 공의가 드러나는 날로, 죄악에 대한 보편적이고 피할 수 없는 심판을 의미합니다. 애굽의 교만과 우상숭배에 동참하고 그를 의지했던 모든 세력들이 함께 심판을 받는 것은, 하나님을 대적하는 모든 연합은 결국 함께 무너질 수밖에 없음을 보여줍니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="OT/OT_26_EZE_30.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="EZE_30" data-title="에스겔 30장">성경 듣기</button>
                </div>
            </div>

            <div class="chapter-card card-book4">
                <h3>시편 78:38-72절: 긍휼과 반역, 그리고 새로운 선택</h3>
                <h4>상세 개요</h4>
                <p>시편 78편의 후반부는 이스라엘의 계속되는 반역과 그럼에도 불구하고 거두지 않으시는 하나님의 긍휼을 극적으로 대조합니다. 하나님은 "긍휼이 풍성하시므로 그들의 죄악을 덮어 주시어 멸망시키지 아니하시고 그의 진노를 여러 번 돌이키"(38절)십니다. 그러나 이스라엘은 가나안 땅에 들어가서도 여전히 우상을 숭배하며 하나님을 격노하게 했습니다. 결국 하나님은 실로의 성소를 떠나시고 북쪽 지파인 에브라임을 버리셨습니다. 그러나 심판 속에서도 하나님은 당신의 백성을 완전히 버리지 않으시고, 남쪽의 유다 지파와 시온 산을 택하시고, 목동이었던 다윗을 새로운 지도자로 세우셔서 "자기 백성인 야곱, 자기의 소유인 이스라엘을 기르게 하셨"(71절)습니다. 이는 하나님의 주권적인 선택과 언약적 신실하심이 인간의 실패를 넘어서서 구속 역사를 이끌어 감을 보여줍니다.</p>
                
                <h4>심층 신학적 해설</h4>
                <ol>
                    <li><strong>인간의 전적 부패와 하나님의 긍휼:</strong> 본문은 인간의 죄성(전적 부패)이 얼마나 집요한지를 보여줍니다. 하나님의 무한한 긍휼과 용서에도 불구하고 이스라엘의 반역은 그치지 않습니다. 이는 인간의 본성이 스스로는 하나님께 순종할 수 없는 상태임을 드러냅니다. 그럼에도 불구하고 하나님께서 진노를 거두시는 유일한 근거는 당신의 '긍휼'입니다. "오직 하나님은 긍휼하시므로 죄악을 덮어 주시며"(38절)라는 구절은 하나님의 용서가 인간의 회개나 노력에 조건 지어진 것이 아니라, 하나님의 주권적인 성품에 근거함을 보여줍니다.</li>
                    <li><strong>하나님의 주권적 선택 (Sovereign Election):</strong> 이스라엘의 실패 역사 속에서 시편 기자는 중요한 신학적 전환을 보여줍니다. 하나님께서는 범죄한 에브라임 지파를 버리시고 "유다 지파와 그가 사랑하시는 시온 산을 택하시며"(68절)라고 선언합니다. 또한 수많은 사람 중에 "그의 종 다윗을 택하시되 양의 우리에서 취하시며"(70절)라고 말합니다. 이는 구원의 주도권이 인간에게 있지 않고, 전적으로 하나님의 주권적인 선택에 있음을 명백히 하는 것입니다. 인간의 실패에도 불구하고 하나님은 당신의 기쁘신 뜻을 따라 새로운 대상(유다, 다윗)을 선택하심으로써 당신의 구속 계획을 신실하게 이어가십니다.</li>
                </ol>

                <div class="btn-group">
                    <button class="btn btn-view" data-path="OT/OT_19_PSA_78.html">본문 보기</button>
                    <button class="btn btn-listen" data-key="PSA_78" data-title="시편 78편">성경 듣기</button>
                </div>
            </div>

            <div class="integration-card">
                <h2>통합 묵상: 언약, 믿음, 그리고 하나님의 주권적 선택</h2>
                <h3>관통하는 주제 논증: 인간의 실패를 넘어서는 하나님의 언약적 신실함</h3>
                <p>오늘의 네 본문은 '하나님의 언약'이라는 웅장한 주제 아래 하나로 묶입니다. 사무엘하 23장에서 다윗은 자신의 불완전함에도 불구하고 하나님께서 자신과 맺으신 '영원한 언약' 때문에 구원을 확신하며 눈을 감습니다. 시편 78편은 이 주제를 이스라엘 역사 전체로 확장합니다. 이스라엘은 언약을 끊임없이 파기하고 반역했지만, 하나님은 당신의 긍휼과 주권적 선택(유다와 다윗을 택하심)을 통해 언약을 신실하게 이어가십니다. 에스겔 30장은 이 언약의 배타성을 보여줍니다. 언약의 하나님을 버리고 세상을 의지하는 것(애굽 동맹)은 하나님의 심판을 자초할 뿐입니다. 그렇다면 이 하나님의 신실한 언약에 인간은 어떻게 참여할 수 있는가? 갈라디아서 3장은 그 유일한 길을 제시합니다. 그것은 바로 율법의 행위가 아닌 '믿음'입니다. 아브라함이 약속을 믿음으로 언약 백성이 되었듯, 이제 그리스도 안에서 모든 믿는 자는 차별 없이 아브라함의 언약적 상속자가 됩니다. 결국 오늘의 본문들은 인간의 죄와 실패에도 불구하고, 하나님께서는 당신의 주권적인 선택과 그리스도를 믿는 믿음을 통해 당신의 영원한 언약을 성취해가신다는 위대한 구속사의 파노라마를 보여줍니다.</p>

                <h3>입체적 핵심 단어 연구: בְּרִית (베리트, 언약)</h3>
                <p>사무엘하 23장 5절에서 다윗이 의지하는 '영원한 언약'(בְּרִית עוֹלָם, 베리트 올람)의 핵심 단어인 '베리트'(בְּרִית)는 성경 전체를 관통하는 핵심 신학 용어입니다. 이 단어는 단순한 계약이나 합의 이상의 의미를 지닙니다. '베리트'는 하나님께서 주권적으로 시작하시고 관계의 조건을 정하시는 엄숙하고 신성한 관계 설정입니다. 여기에는 종종 희생 제사를 동반하는 '자르다'는 어원이 암시되어, 언약을 어길 시 생명을 건다는 엄중함이 담겨있습니다. 성경에는 노아 언약, 아브라함 언약, 모세 언약, 다윗 언약 등 여러 언약이 등장하지만, 이것들은 점진적으로 계시되는 하나의 '은혜 언약'의 다른 측면들입니다. 이 모든 구약의 언약들은 결국 예수 그리스도께서 자신의 피로 세우신 '새 언약'(눅 22:20) 안에서 성취되고 완성됩니다. 그리스도의 십자가는 언약을 파기한 인류의 죄 값을 치르는 희생 제사이며, 이제 누구든지 그리스도를 믿기만 하면 이 영원한 언약 관계 안으로 들어와 하나님의 자녀가 되는 특권을 누리게 됩니다. </p>
                
                <h3>심층 상호 참조</h3>
                <ul>
                    <li><strong>사무엘하 23:5 & 갈라디아서 3:17-18:</strong> 다윗은 자신의 집이 온전치 못함을 알면서도 하나님의 "영원한 언약"을 의지합니다. 이 신앙의 본질을 바울이 신학적으로 설명합니다. 바울은 하나님께서 아브라함에게 주신 "미리 약속하신 언약"은 430년 후에 생긴 율법이 폐기할 수 없다고 말하며, "그 약속은 하나님이 은혜로 주신 것"이라고 단언합니다. 다윗의 고백과 바울의 논증은 모두 구원이 인간의 행위(온전함, 율법 준수)가 아닌, 하나님의 주권적이고 은혜로운 약속(언약)에 근거한다는 동일한 진리를 증거합니다.</li>
                    <li><strong>시편 78:56-58 & 에스겔 30:5:</strong> 시편 기자는 이스라엘이 가나안에 들어가서도 "지존하신 하나님을 시험하고 배반하여 그의 명령을 지키지 아니하며... 자기들의 산당들로 그의 노를 일으키며 자기들이 조각한 우상들로 그의 진투를 일으켰"다고 고발합니다. 즉, 하나님을 버리고 다른 신과 세력을 의지한 것입니다. 이는 에스겔에서 애굽이 심판받을 때 그를 의지했던 "동맹한 땅의 백성들"이 함께 멸망하는 것과 같은 원리입니다. 두 본문 모두 언약의 하나님을 배반하고 다른 대상을 의지하는 것이 영적 간음이며, 결국 심판을 피할 수 없음을 보여줍니다.</li>
                </ul>

                <h3>적용을 위한 성찰 질문</h3>
                <ol>
                    <li>다윗은 인생의 마지막 순간에 자신의 성공이나 업적이 아닌 '하나님의 영원한 언약'을 붙들었습니다. 당신의 인생의 마지막에 남기고 싶은 유일한 신앙고백은 무엇이며, 그것을 위해 오늘 당신은 무엇에 소망을 두고 살아가고 있습니까?</li>
                    <li>갈라디아서는 우리가 율법의 행위가 아닌 오직 믿음으로 하나님의 자녀가 되었다고 선포합니다. 당신은 여전히 자신의 종교적 행위나 도덕적 노력으로 하나님의 인정을 얻으려고 애쓰는 '어리석음'에 빠져있지는 않습니까? 당신의 삶에서 '육체로 마치려는' 영역은 무엇입니까?</li>
                    <li>시편 78편은 이스라엘의 실패가 '하나님의 행하신 일을 잊어버리는 것'에서 시작되었다고 반복해서 지적합니다. 당신의 삶에서 하나님의 은혜를 기억하고 감사하기 위한 구체적인 영적 습관(묵상, 감사일기 등)은 무엇이며, 어떻게 그것을 다음 세대에게 전수할 수 있을까요?</li>
                    <li>하나님은 이스라엘의 실패에도 불구하고 다윗을 주권적으로 선택하여 구속 역사를 이어가셨습니다. 당신의 삶에 반복되는 실패와 연약함에도 불구하고, 여전히 당신을 택하시고 사용하시는 하나님의 주권적인 은혜를 신뢰하고 있습니까? 그 신뢰가 당신의 삶을 어떻게 변화시킬 수 있을까요?</li>
                </ol>
            </div>
        </main>

        <footer>
            <p>© 2025 KBD 맥체인 성경읽기 프로젝트</p>
        </footer>
    </div>

    <div id="bible-modal" class="modal">
        <div class="modal-content">
            <div class="modal-body" id="modal-body-content"><div class="spinner"></div></div>
        </div>
    </div>

    <div id="audio-player" class="audio-player">
        <div class="audio-player-info" id="player-info"></div>
        <div class="audio-player-controls">
            <button id="play-pause-btn">▶</button>
            <button id="close-player-btn">✖</button>
        </div>
    </div>
    <div id="youtube-player-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainContainer = document.getElementById('main-container');
            const bibleModal = document.getElementById('bible-modal');
            const modalBody = document.getElementById('modal-body-content');
            const audioPlayerBar = document.getElementById('audio-player');
            const playerInfo = document.getElementById('player-info');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const closePlayerBtn = document.getElementById('close-player-btn');
            
            let ytPlayer;
            let audioLinks = new Map();
            let isPlayerReady = false;

            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            window.onYouTubeIframeAPIReady = function() {
                ytPlayer = new YT.Player('youtube-player-container', {
                    height: '0',
                    width: '0',
                    events: {
                        'onReady': () => { isPlayerReady = true; },
                        'onStateChange': (event) => {
                            playPauseBtn.innerHTML = (event.data === YT.PlayerState.PLAYING) ? '❚❚' : '▶';
                        }
                    }
                });
            }

            async function loadAudioLinks() {
                try {
                    const response = await fetch('../address/mcbible.txt');
                    if (!response.ok) throw new Error('오디오 목록 파일을 불러올 수 없습니다.');
                    const text = await response.text();
                    text.split('\n').forEach(line => {
                        if (line.trim() !== '') {
                            const parts = line.split(/\s+/);
                            const fullKey = parts[0];
                            const url = parts[1];
                            const keyParts = fullKey.split('_'); 
                            
                            if (keyParts.length >= 3) {
                                const book = keyParts[2];
                                const chapter = parseInt(keyParts.at(-1), 10);
                                const shortKey = `${book}_${chapter}`;
                                audioLinks.set(shortKey, url);
                            }
                        }
                    });
                } catch (error) {
                    console.error('오디오 링크 로딩 오류:', error);
                }
            }
            
            function getYouTubeID(url) {
                const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            mainContainer.addEventListener('click', async (e) => {
                const target = e.target.closest('.btn');
                if (!target) return;

                if (target.classList.contains('btn-view')) {
                    const path = target.dataset.path;
                    bibleModal.style.display = 'block';
                    modalBody.innerHTML = '<div class="spinner"></div>';
                    try {
                        const response = await fetch(`../bible_html/${path}`);
                        if (!response.ok) throw new Error(`HTTP 오류! 상태: ${response.status}`);
                        const html = await response.text();
                        modalBody.innerHTML = html;
                    } catch (error) {
                        modalBody.innerHTML = `<p>본문을 불러오는 데 실패했습니다: ${error.message}</p>`;
                    }
                }
                
                if (target.classList.contains('btn-listen')) {
                    if (!isPlayerReady) {
                        alert('오디오 플레이어가 아직 준비되지 않았습니다.');
                        return;
                    }
                    if (audioLinks.size === 0) {
                        await loadAudioLinks(); 
                         if (audioLinks.size === 0) {
                            alert('오디오 목록을 불러오지 못했습니다. 파일 경로와 서버 상태를 확인해주세요.');
                            return;
                        }
                    }
                    const key = target.dataset.key;
                    const title = target.dataset.title;
                    const url = audioLinks.get(key);

                    if (url) {
                        const videoId = getYouTubeID(url);
                        if (videoId) {
                            ytPlayer.loadVideoById(videoId);
                            playerInfo.textContent = `재생중: ${title}`;
                            audioPlayerBar.classList.add('show');
                        } else {
                            alert(`'${title}'의 YouTube 영상 ID를 추출할 수 없습니다.`);
                        }
                    } else {
                        alert(`'${title}'에 해당하는 오디오를 찾을 수 없습니다. (Key: ${key})`);
                    }
                }
            });

            bibleModal.addEventListener('click', (e) => {
                if (e.target === bibleModal) {
                    bibleModal.style.display = 'none';
                }
            });

            playPauseBtn.addEventListener('click', () => {
                if (!ytPlayer || typeof ytPlayer.getPlayerState !== 'function') return;
                const playerState = ytPlayer.getPlayerState();
                if (playerState === YT.PlayerState.PLAYING) {
                    ytPlayer.pauseVideo();
                } else {
                    ytPlayer.playVideo();
                }
            });

            closePlayerBtn.addEventListener('click', () => {
                if (ytPlayer && typeof ytPlayer.stopVideo === 'function') {
                    ytPlayer.stopVideo();
                }
                audioPlayerBar.classList.remove('show');
            });
            
            loadAudioLinks();
        });
    </script>
</body>
</html>
