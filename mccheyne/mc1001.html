<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>맥체인 성경읽기 - 10월 1일</title>
    <style>
        :root {
            --font-size-base: 17px;
            --line-height-base: 1.8;
            --color-text: #212529;
            --color-card-book1: #4285F4;
            --color-card-book2: #DB4437;
            --color-card-book3: #F4B400;
            --color-card-book4: #0F9D58;
            --color-integration-card: #808080;
            --max-width: 1280px;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: var(--color-text);
            font-size: var(--font-size-base);
            line-height: var(--line-height-base);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%;
            max-width: var(--max-width);
            padding: 20px;
            box-sizing: border-box;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        h1 {
            font-size: clamp(2.0rem, 5vw, 2.8rem);
            font-weight: 700;
            margin: 0;
        }
        h2 {
            font-size: clamp(1.5rem, 4vw, 2.0rem);
            font-weight: 600;
            margin-top: 10px;
            color: #495057;
        }
        .chapter-card, .integration-card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            padding: 30px;
            border-left: 8px solid;
        }
        .card-book1 { border-color: var(--color-card-book1); }
        .card-book2 { border-color: var(--color-card-book2); }
        .card-book3 { border-color: var(--color-card-book3); }
        .card-book4 { border-color: var(--color-card-book4); }
        .integration-card { border-color: var(--color-integration-card); }

        h3 {
            font-size: 1.6rem;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .card-book1 h3 { color: var(--color-card-book1); }
        .card-book2 h3 { color: var(--color-card-book2); }
        .card-book3 h3 { color: var(--color-card-book3); }
        .card-book4 h3 { color: var(--color-card-book4); }
        .integration-card h3 { color: var(--color-integration-card); }

        h4 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 25px;
            margin-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }
        p, ul {
            margin-bottom: 1rem;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin-bottom: 0.5rem;
        }
        .button-group {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            color: white;
        }
        .btn-view { background-color: #6c757d; }
        .btn-listen { background-color: #007bff; }
        .btn-view:hover { background-color: #5a6268; transform: translateY(-2px); }
        .btn-listen:hover { background-color: #0056b3; transform: translateY(-2px); }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 900px;
            border-radius: 8px;
            animation-name: slideIn;
            animation-duration: 0.4s;
        }
        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0}
            to {transform: translateY(0); opacity: 1}
        }
        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
        #bible-text-content {
            line-height: 2;
        }
        #modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #343a40;
        }

        /* Audio Player Styles */
        #audio-player-bar {
            position: fixed;
            bottom: -100px;
            left: 0;
            width: 100%;
            background-color: #212529;
            color: white;
            padding: 15px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1050;
            transition: bottom 0.3s ease-in-out;
        }
        #audio-player-bar.show {
            bottom: 0;
        }
        #player-info {
            font-weight: bold;
        }
        #player-controls button {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: 15px;
        }
        #youtube-player {
            display: none;
        }

        footer {
            width: 100%;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            background-color: #e9ecef;
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>맥체인 성경읽기</h1>
            <h2>10월 1일</h2>
        </header>

        <main>
            <section class="chapter-card card-book1">
                <h3>열왕기상 3장: 지혜의 왕, 솔로몬</h3>
                <h4>개요</h4>
                <p>솔로몬이 왕이 된 후, 하나님께 일천 번제를 드리고 지혜를 구하는 장면이 기록되어 있습니다. 하나님은 그의 구함에 기뻐하시며 지혜뿐만 아니라 부와 영광까지 약속하십니다. 이어 두 여인의 재판 이야기를 통해 솔로몬의 신적인 지혜가 온 이스라엘에 드러납니다.</p>

                <h4>신학적 해설</h4>
                <ol>
                    <li><strong>하나님 나라의 왕이 구해야 할 최우선 가치:</strong> 솔로몬은 자신의 유익이나 정적의 멸망이 아닌, 백성을 잘 다스릴 수 있는 '듣는 마음(지혜)'을 구합니다. 이는 하나님의 통치가 대리 통치자인 왕을 통해 이 땅에 구현되기 위해 가장 필요한 것이 무엇인지를 보여줍니다. 개혁주의 신학에서 통치자의 첫째 의무는 하나님의 공의와 정의를 실현하는 것이며, 솔로몬의 기도는 이 원리를 정확히 반영합니다.</li>
                    <li><strong>언약의 신실하심과 하나님의 주권:</strong> 하나님께서는 다윗에게 하신 언약을 기억하시고 그의 아들 솔로몬에게 은혜를 베푸십니다. 솔로몬의 지혜는 개인의 능력이 아니라, 전적으로 하나님의 주권적인 선물입니다. 이는 구원이 인간의 공로나 자격이 아닌 오직 하나님의 은혜로 말미암는다는 개혁주의 구원론과 맥을 같이합니다.</li>
                    <li><strong>지혜의 실제적 적용으로서의 공의:</strong> 유명한 '솔로몬의 재판'은 단순히 명석한 판결을 넘어, 하나님의 공의가 어떻게 생명을 살리고 진실을 드러내는지를 보여주는 구체적인 사례입니다. 참된 지혜는 추상적인 지식이 아니라, 하나님의 성품인 공의와 사랑을 삶의 현장에서 구현하는 능력으로 나타납니다.</li>
                </ol>

                <div class="button-group">
                    <button class="btn btn-view" data-book="열왕기상" data-chapter="3">본문 보기</button>
                    <button class="btn btn-listen" data-book="열왕기상" data-key="1KI_3">성경 듣기</button>
                </div>
            </section>

            <section class="chapter-card card-book2">
                <h3>에베소서 1장: 창세 전의 선택과 구원의 찬미</h3>
                <h4>개요</h4>
                <p>바울은 에베소 교회 성도들을 향한 찬송으로 편지를 시작합니다. 성부 하나님의 창세 전 선택, 성자 예수 그리스도를 통한 구속, 그리고 성령 하나님의 인치심이라는 삼위일체 하나님의 구원 사역을 장엄하게 노래하며, 교회가 받은 영적 복이 무엇인지 밝힙니다.</p>

                <h4>신학적 해설</h4>
                <ol>
                    <li><strong>예정론과 하나님의 주권적 선택:</strong> 에베소서 1장은 개혁주의 신학의 핵심 교리인 '예정론'의 가장 강력한 성경적 근거 중 하나입니다. "창세 전에 그리스도 안에서 우리를 택하사" (4절)라는 말씀은 구원의 주도권이 전적으로 하나님께 있음을 선언합니다. 이 선택은 인간의 어떠한 조건이나 예견된 믿음에 근거한 것이 아니라, 오직 "그 기쁘신 뜻대로" (5절) 이루어진 주권적 작정입니다.</li>
                    <li><strong>그리스도 중심적 구원 (In Christ):</strong> 본문의 모든 영적 복은 '그리스도 안에서' 주어진다는 사실이 반복적으로 강조됩니다. 선택, 구속, 기업이 됨, 인치심 등 모든 구원의 과정은 그리스도와의 연합을 통해 효력을 발휘합니다. 그리스도는 구원의 유일한 중보자이시며, 그의 피로 말미암는 죄 사함(7절)은 구원의 핵심입니다.</li>
                    <li><strong>교회의 정체성과 목적:</strong> 하나님께서 우리를 선택하시고 구속하신 궁극적인 목적은 "그의 은혜의 영광을 찬송하게 하려는 것"(6, 12, 14절)입니다. 즉, 교회(구원받은 성도들의 공동체)는 하나님의 영광을 드러내는 증거이며, 그 존재 자체가 하나님을 향한 찬양이 됩니다. 교회는 '그의 몸이니 만물 안에서 만물을 충만하게 하시는 이의 충만'(23절)으로서, 그리스도의 통치를 세상에 나타내는 사명을 가집니다.</li>
                </ol>

                <div class="button-group">
                    <button class="btn btn-view" data-book="에베소서" data-chapter="1">본문 보기</button>
                    <button class="btn btn-listen" data-book="에베소서" data-key="EPH_1">성경 듣기</button>
                </div>
            </section>

            <section class="chapter-card card-book3">
                <h3>에스겔 34장: 거짓 목자와 참된 목자</h3>
                <h4>개요</h4>
                <p>하나님은 자기 배만 불리고 양 떼를 돌보지 않은 이스라엘의 지도자들(거짓 목자들)을 준엄하게 책망하십니다. 그리고 장차 하나님께서 친히 목자가 되시고, 또한 '내 종 다윗'으로 지칭되는 참된 목자를 세워 흩어진 양 떼를 모으고 회복시키실 것을 약속하십니다.</p>

                <h4>신학적 해설</h4>
                <ol>
                    <li><strong>언약 공동체 지도자의 책임:</strong> 이스라엘의 지도자들은 하나님과 백성 사이의 언약적 책임을 망각했습니다. 그들은 양들을 먹이고 보호하는 대신 착취했습니다. 이는 하나님 나라의 직분(왕, 제사장, 선지자)이 섬김을 위한 것임을 망각한 타락의 전형을 보여줍니다. 교회 내의 모든 직분 역시 그리스도를 본받아 양 떼를 섬기는 목자의 심정을 가져야 함을 교훈합니다.</li>
                    <li><strong>하나님의 자기 선언 "내가 친히 내 양의 목자가 되어":</strong> 인간 지도자들의 실패는 하나님의 구원 계획을 좌절시키지 못합니다. 오히려 하나님께서는 "내가 친히" 개입하여 흩어진 양들을 찾고, 상한 자를 싸매주시겠다고 선언하십니다. 이는 하나님의 언약적 신실함과 자기 백성을 향한 불변의 사랑을 보여주는 강력한 구속사적 선포입니다.</li>
                    <li><strong>메시아 예언으로서의 '한 목자':</strong> "내 종 다윗"을 세워 목자로 삼으시겠다는 약속(23절)은 단순히 다윗 왕조의 회복을 넘어, 장차 오실 참된 목자이신 예수 그리스도를 가리키는 명백한 메시아 예언입니다. 예수님은 요한복음 10장에서 자신을 "선한 목자"로 선언하시며 이 예언을 성취하셨습니다. 그는 양들을 위해 목숨을 버리심으로 거짓 목자들과는 근본적으로 다른, 참된 목자의 모습을 보여주셨습니다.</li>
                </ol>

                <div class="button-group">
                    <button class="btn btn-view" data-book="에스겔" data-chapter="34">본문 보기</button>
                    <button class="btn btn-listen" data-book="에스겔" data-key="EZE_34">성경 듣기</button>
                </div>
            </section>

            <section class="chapter-card card-book4">
                <h3>시편 83-84편: 하나님의 침묵과 임재에 대한 갈망</h3>
                <h4>개요</h4>
                <p>시편 83편은 연합한 적대 세력들의 위협 앞에서 하나님의 침묵을 깨고 개입해주시기를 간구하는 공동체의 탄원시입니다. 반면 시편 84편은 하나님의 집에 거하는 복과 그 임재를 사모하는 순례자의 노래로, 극명한 대조를 이룹니다.</p>

                <h4>신학적 해설</h4>
                <ol>
                    <li><strong>하나님의 이름을 위한 기도(시 83편):</strong> 시인은 단순히 적들의 멸망을 구하는 것이 아니라, 그들이 수치를 당하여 "여호와라 이름하신 주만 온 세계의 지존자로 알게 하소서"(83:18)라고 기도합니다. 이는 개인적인 복수를 넘어, 이 모든 심판의 과정이 궁극적으로 하나님의 주권과 영광을 드러내는 데 목적이 있음을 보여줍니다. 기도의 초점은 '나의 안전'에서 '주의 이름'으로 옮겨갑니다.</li>
                    <li><strong>성전 중심의 신앙과 하나님의 임재(시 84편):</strong> 시인은 "주의 장막"을 사모하여 마음이 쇠약해질 정도라고 고백합니다. 성전은 단순한 건물이 아니라 하나님의 임재와 통치가 가시적으로 나타나는 장소입니다. 구약 시대 성전이 예표했던 것은 신약 시대에 예수 그리스도의 몸(교회)과 성도 개인을 통해 성취되었습니다. 우리는 이제 그리스도 안에서 언제 어디서나 하나님께 나아갈 수 있는 특권을 누립니다.</li>
                    <li><strong>세상에서의 순례자와 '눈물 골짜기'(시 84편):</strong> "그들이 눈물 골짜기로 지나갈 때에 그 곳에 많은 샘이 있을 것이며"(84:6)라는 구절은 성도의 지상 생활이 고난과 눈물이 가득한 순례의 여정임을 암시합니다. 그러나 하나님께 소망을 두는 자는 그 고난 속에서도 하나님의 위로와 공급(샘)을 경험하며, 힘을 더 얻어 마침내 하나님 앞에 서게 될 것을 노래합니다. 이는 종말론적 소망을 가진 성도의 삶의 모습을 아름답게 그려냅니다.</li>
                </ol>

                <div class="button-group">
                    <button class="btn btn-view" data-book="시편" data-chapter="83">시편 83편 본문 보기</button>
                    <button class="btn btn-listen" data-book="시편" data-key="PSA_83">시편 83편 성경 듣기</button>
                    <button class="btn btn-view" data-book="시편" data-chapter="84">시편 84편 본문 보기</button>
                    <button class="btn btn-listen" data-book="시편" data-key="PSA_84">시편 84편 성경 듣기</button>
                </div>
            </section>
            
            <section class="integration-card">
                <h3>통합 묵상: 하나님의 집, 하나님의 백성</h3>
                
                <h4>관통하는 주제</h4>
                <p>오늘의 본문들은 '하나님의 백성을 누가, 어떻게 다스리고 돌보는가'라는 주제로 수렴됩니다. 열왕기상은 지혜로운 왕을 통한 통치를, 에스겔은 실패한 지도자들과 대조되는 참된 목자이신 하나님과 메시아를, 에베소서는 창세 전부터 시작된 삼위 하나님의 주권적 돌보심을, 시편은 그 하나님의 임재(집)를 갈망하는 백성의 모습을 보여줍니다. 결국 인간 지도자의 불완전함에도 불구하고, 하나님은 자신의 백성을 친히, 그리고 그의 아들 그리스도를 통해 완전하게 돌보시고 구원하신다는 구속사의 큰 그림이 드러납니다.</p>

                <h4>핵심 단어 연구</h4>
                <p><strong>'택하사' (ἐκλέγομαι, 에클레고마이) - 에베소서 1:4</strong></p>
                <p>헬라어 '에클레고마이'는 단순히 '고르다'는 의미를 넘어 '특별한 목적을 위해 신중하게 선택하여 따로 구별하다'는 깊은 의미를 담고 있습니다. 이 단어는 중간태(middle voice)로 사용되어, 하나님께서 '자신을 위하여' 우리를 선택하셨음을 강조합니다. 이는 선택의 주도권과 목적이 전적으로 하나님께 있음을 보여줍니다. 이 선택은 우리의 자격이나 가능성을 보고 이루어진 것이 아니라, 창세 전에, 하나님의 절대적인 기쁨과 사랑 안에서 이루어진 주권적 행위입니다. 그러므로 우리의 구원은 흔들릴 수 없는 반석 위에 서 있으며, 그 목적은 우리의 자랑이 아닌 하나님의 영광을 찬송하는 것입니다.</p>

                <h4>본문 간 상호 참조</h4>
                <ul>
                    <li><strong>열왕기상 3:9 & 에스겔 34:15</strong><br>솔로몬은 백성을 "재판하여 선악을 분별하게" 해달라고 지혜를 구합니다. 이는 목자의 중요한 역할입니다. 에스겔에서 하나님은 "내가 친히 내 양의 목자가 되어 그들을 눕게 할지라"고 선언하심으로써, 인간 왕의 불완전함을 넘어선 완전한 돌봄과 안식을 약속하십니다. 솔로몬의 구함은 참된 왕이신 그리스도의 통치에 대한 예표이며, 하나님은 그 기도를 통해 자신의 궁극적인 목자 되심을 계시합니다.</li>
                    <li><strong>에스겔 34:23 & 에베소서 1:22</strong><br>에스겔은 하나님께서 "한 목자", "내 종 다윗"을 세워 백성을 돌볼 것이라 예언합니다. 이 예언은 에베소서에서 하나님께서 그리스도를 "만물 위에 교회의 머리로 삼으셨느니라"는 선포를 통해 성취됩니다. 그리스도는 옛 다윗 왕조를 잇는 참된 왕이자, 자기 백성을 완벽하게 아시고 돌보시는 선한 목자이시며, 교회의 유일한 머리가 되십니다.</li>
                    <li><strong>시편 84:10 & 에베소서 1:3</strong><br>시편 기자는 "주의 궁정에서의 한 날이 다른 곳에서의 천 날보다 낫다"고 고백하며 하나님의 임재를 최고의 가치로 여깁니다. 에베소서는 이 소망이 어떻게 성취되었는지를 보여줍니다. 우리는 이제 그리스도 안에서 "하늘에 속한 모든 신령한 복"을 받은 자로서, 지상의 성전이 아닌 하나님 보좌 우편에 앉으신 그리스도와 연합하여 날마다 하나님의 임재를 누릴 수 있게 되었습니다.</li>
                </ul>

                <h4>묵상을 위한 질문</h4>
                <ol>
                    <li>나는 오늘 나의 삶의 문제들을 해결하기 위해 솔로몬처럼 세상의 부나 명예가 아닌, 하나님의 뜻을 분별하는 '듣는 마음(지혜)'을 구하고 있는가?</li>
                    <li>에베소서 1장이 선포하는 것처럼, 나의 구원이 나의 노력이 아닌 창세 전 하나님의 주권적 선택에 근거한다는 사실이 오늘 나에게 어떤 위로와 감격을 주는가? 나는 그 은혜의 영광을 찬송하는 삶을 살고 있는가?</li>
                    <li>혹시 나는 다른 사람을 돌보는 위치(가정, 교회, 직장)에서 양들을 착취했던 거짓 목자처럼 나의 유익을 먼저 구하지는 않았는가? 상하고 잃어버린 자를 친히 찾아오시는 선한 목자 예수님의 마음을 어떻게 닮아갈 수 있을까?</li>
                </ol>
            </section>
        </main>
    </div>

    <footer>
        <p>© 2025 KBD 맥체인 성경읽기 프로젝트</p>
    </footer>

    <div id="bible-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <div class="modal-body">
                <div id="bible-text-content"></div>
            </div>
        </div>
    </div>
    
    <div id="audio-player-bar">
        <div id="player-info"></div>
        <div id="player-controls">
            <button id="play-pause-btn">▶</button>
            <button id="close-player-btn">×</button>
        </div>
        <div id="youtube-player"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Bible data map
            const bibleData = {
                '창세기': { bookCode: 'GEN', testament: 'OT', totalChapters: 50, bookNum: '01' }, '출애굽기': { bookCode: 'EXO', testament: 'OT', totalChapters: 40, bookNum: '02' }, '레위기': { bookCode: 'LEV', testament: 'OT', totalChapters: 27, bookNum: '03' }, '민수기': { bookCode: 'NUM', testament: 'OT', totalChapters: 36, bookNum: '04' }, '신명기': { bookCode: 'DEU', testament: 'OT', totalChapters: 34, bookNum: '05' }, '여호수아': { bookCode: 'JOS', testament: 'OT', totalChapters: 24, bookNum: '06' }, '사사기': { bookCode: 'JDG', testament: 'OT', totalChapters: 21, bookNum: '07' }, '룻기': { bookCode: 'RUT', testament: 'OT', totalChapters: 4, bookNum: '08' }, '사무엘상': { bookCode: '1SA', testament: 'OT', totalChapters: 31, bookNum: '09' }, '사무엘하': { bookCode: '2SA', testament: 'OT', totalChapters: 24, bookNum: '10' }, '열왕기상': { bookCode: '1KI', testament: 'OT', totalChapters: 22, bookNum: '09' }, '열왕기하': { bookCode: '2KI', testament: 'OT', totalChapters: 25, bookNum: '10' }, '역대상': { bookCode: '1CH', testament: 'OT', totalChapters: 29, bookNum: '13' }, '역대하': { bookCode: '2CH', testament: 'OT', totalChapters: 36, bookNum: '14' }, '에스라': { bookCode: 'EZR', testament: 'OT', totalChapters: 10, bookNum: '15' }, '느헤미야': { bookCode: 'NEH', testament: 'OT', totalChapters: 13, bookNum: '16' }, '에스더': { bookCode: 'EST', testament: 'OT', totalChapters: 10, bookNum: '17' }, '욥기': { bookCode: 'JOB', testament: 'OT', totalChapters: 42, bookNum: '18' }, '시편': { bookCode: 'PSA', testament: 'OT', totalChapters: 150, bookNum: '19' }, '잠언': { bookCode: 'PRO', testament: 'OT', totalChapters: 31, bookNum: '20' }, '전도서': { bookCode: 'ECC', testament: 'OT', totalChapters: 12, bookNum: '21' }, '아가': { bookCode: 'SNG', testament: 'OT', totalChapters: 8, bookNum: '22' }, '이사야': { bookCode: 'ISA', testament: 'OT', totalChapters: 66, bookNum: '23' }, '예레미야': { bookCode: 'JER', testament: 'OT', totalChapters: 52, bookNum: '24' }, '예레미야애가': { bookCode: 'LAM', testament: 'OT', totalChapters: 5, bookNum: '25' }, '에스겔': { bookCode: 'EZE', testament: 'OT', totalChapters: 48, bookNum: '26' }, '다니엘': { bookCode: 'DAN', testament: 'OT', totalChapters: 12, bookNum: '27' }, '호세아': { bookCode: 'HOS', testament: 'OT', totalChapters: 14, bookNum: '28' }, '요엘': { bookCode: 'JOL', testament: 'OT', totalChapters: 3, bookNum: '29' }, '아모스': { bookCode: 'AMO', testament: 'OT', totalChapters: 9, bookNum: '30' }, '오바댜': { bookCode: 'OBA', testament: 'OT', totalChapters: 1, bookNum: '31' }, '요나': { bookCode: 'JON', testament: 'OT', totalChapters: 4, bookNum: '32' }, '미가': { bookCode: 'MIC', testament: 'OT', totalChapters: 7, bookNum: '33' }, '나훔': { bookCode: 'NAH', testament: 'OT', totalChapters: 3, bookNum: '34' }, '하박국': { bookCode: 'HAB', testament: 'OT', totalChapters: 3, bookNum: '35' }, '스바냐': { bookCode: 'ZEP', testament: 'OT', totalChapters: 3, bookNum: '36' }, '학개': { bookCode: 'HAG', testament: 'OT', totalChapters: 2, bookNum: '37' }, '스가랴': { bookCode: 'ZEC', testament: 'OT', totalChapters: 14, bookNum: '38' }, '말라기': { bookCode: 'MAL', testament: 'OT', totalChapters: 4, bookNum: '39' },
                '마태복음': { bookCode: 'MAT', testament: 'NT', totalChapters: 28, bookNum: '01' }, '마가복음': { bookCode: 'MRK', testament: 'NT', totalChapters: 16, bookNum: '02' }, '누가복음': { bookCode: 'LUK', testament: 'NT', totalChapters: 24, bookNum: '03' }, '요한복음': { bookCode: 'JHN', testament: 'NT', totalChapters: 21, bookNum: '04' }, '사도행전': { bookCode: 'ACT', testament: 'NT', totalChapters: 28, bookNum: '05' }, '로마서': { bookCode: 'ROM', testament: 'NT', totalChapters: 16, bookNum: '06' }, '고린도전서': { bookCode: '1CO', testament: 'NT', totalChapters: 16, bookNum: '07' }, '고린도후서': { bookCode: '2CO', testament: 'NT', totalChapters: 13, bookNum: '08' }, '갈라디아서': { bookCode: 'GAL', testament: 'NT', totalChapters: 6, bookNum: '09' }, '에베소서': { bookCode: 'EPH', testament: 'NT', totalChapters: 6, bookNum: '10' }, '빌립보서': { bookCode: 'PHP', testament: 'NT', totalChapters: 4, bookNum: '11' }, '골로새서': { bookCode: 'COL', testament: 'NT', totalChapters: 4, bookNum: '12' }, '데살로니가전서': { bookCode: '1TH', testament: 'NT', totalChapters: 5, bookNum: '13' }, '데살로니가후서': { bookCode: '2TH', testament: 'NT', totalChapters: 3, bookNum: '14' }, '디모데전서': { bookCode: '1TI', testament: 'NT', totalChapters: 6, bookNum: '15' }, '디모데후서': { bookCode: '2TI', testament: 'NT', totalChapters: 4, bookNum: '16' }, '디도서': { bookCode: 'TIT', testament: 'NT', totalChapters: 3, bookNum: '17' }, '빌레몬서': { bookCode: 'PHM', testament: 'NT', totalChapters: 1, bookNum: '18' }, '히브리서': { bookCode: 'HEB', testament: 'NT', totalChapters: 13, bookNum: '19' }, '야고보서': { bookCode: 'JAS', testament: 'NT', totalChapters: 5, bookNum: '20' }, '베드로전서': { bookCode: '1PE', testament: 'NT', totalChapters: 5, bookNum: '21' }, '베드로후서': { bookCode: '2PE', testament: 'NT', totalChapters: 3, bookNum: '22' }, '요한1서': { bookCode: '1JN', testament: 'NT', totalChapters: 5, bookNum: '23' }, '요한2서': { bookCode: '2JN', testament: 'NT', totalChapters: 1, bookNum: '24' }, '요한3서': { bookCode: '3JN', testament: 'NT', totalChapters: 1, bookNum: '25' }, '유다서': { bookCode: 'JUD', testament: 'NT', totalChapters: 1, bookNum: '26' }, '요한계시록': { bookCode: 'REV', testament: 'NT', totalChapters: 22, bookNum: '27' }
            };

            // Modal
            const modal = document.getElementById('bible-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('bible-text-content');
            
            document.querySelectorAll('.btn-view').forEach(button => {
                button.addEventListener('click', async () => {
                    const book = button.dataset.book;
                    const chapter = button.dataset.chapter;
                    const bookInfo = bibleData[book];
                    if (!bookInfo) return;

                    const chapterPadded = String(chapter).padStart(2, '0');
                    const fileName = `${bookInfo.testament}_${bookInfo.bookNum}_${bookInfo.bookCode}_${chapterPadded}.html`;
                    const filePath = `../bible_html/${bookInfo.testament}/${fileName}`;
                    
                    modalTitle.textContent = `${book} ${chapter}장`;
                    modalContent.innerHTML = '로딩 중...';
                    modal.style.display = 'block';

                    try {
                        const response = await fetch(filePath);
                        if (!response.ok) throw new Error('파일을 불러올 수 없습니다.');
                        const text = await response.text();
                        modalContent.innerHTML = text;
                    } catch (error) {
                        modalContent.innerHTML = '성경 본문을 불러오는 데 실패했습니다.';
                        console.error('Error fetching bible text:', error);
                    }
                });
            });

            window.addEventListener('click', (event) => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });

            // Audio Player
            const audioPlayerBar = document.getElementById('audio-player-bar');
            const playerInfo = document.getElementById('player-info');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const closePlayerBtn = document.getElementById('close-player-btn');
            let player;
            let audioLinks = {};
            let isPlaying = false;
            let currentBook = '';

            async function loadAudioLinks() {
                try {
                    const response = await fetch('../address/mcbible.txt');
                    if (!response.ok) throw new Error('오디오 주소 파일을 찾을 수 없습니다.');
                    const text = await response.text();
                    text.split('\n').forEach(line => {
                        if (line.trim()) {
                            const [key, url] = line.split(/\s+/);
                            // Normalize key by removing testament prefix if it exists
                            const normalizedKey = key.replace(/^(OT_|NT_)/, '');
                            audioLinks[normalizedKey] = url;
                        }
                    });
                } catch (error) {
                    console.error("Error loading audio links:", error);
                    alert("오디오 주소 목록을 불러오는 데 실패했습니다.");
                }
            }

            function getYouTubeID(url) {
                let id = '';
                try {
                    const urlObj = new URL(url);
                    if (urlObj.hostname === 'youtu.be') {
                        id = urlObj.pathname.slice(1);
                    } else if (urlObj.hostname.includes('youtube.com')) {
                        id = urlObj.searchParams.get('v');
                    } else if (urlObj.hostname.includes('google.com') && urlObj.pathname.includes('search')) {
                        const youtubeUrl = new URL(urlObj.searchParams.get('q'));
                        id = youtubeUrl.searchParams.get('v');
                    }
                } catch(e) {
                    // Fallback for malformed URLs
                    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
                    const match = url.match(regExp);
                    if (match && match[2].length == 11) {
                        id = match[2];
                    }
                }
                return id;
            }

            function onYouTubeIframeAPIReady() {
                player = new YT.Player('youtube-player', {
                    height: '0',
                    width: '0',
                    events: {
                        'onStateChange': onPlayerStateChange
                    }
                });
            }

            function onPlayerStateChange(event) {
                if (event.data === YT.PlayerState.PLAYING) {
                    isPlaying = true;
                    playPauseBtn.textContent = '⏸';
                } else {
                    isPlaying = false;
                    playPauseBtn.textContent = '▶';
                }
            }
            
            if (window.YT) {
                onYouTubeIframeAPIReady();
            } else {
                const tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
            }

            document.querySelectorAll('.btn-listen').forEach(button => {
                button.addEventListener('click', () => {
                    const book = button.dataset.book;
                    const key = button.dataset.key; // e.g., 1KI_3 or PSA_83
                    const url = audioLinks[key];
                    
                    if (url) {
                        const videoId = getYouTubeID(url);
                        if (videoId) {
                            currentBook = `${book} ${key.split('_')[1]}장`;
                            playerInfo.textContent = currentBook;
                            player.loadVideoById(videoId);
                            audioPlayerBar.classList.add('show');
                        } else {
                            alert('유효한 YouTube 영상 ID를 찾을 수 없습니다.');
                        }
                    } else {
                        alert(`'${book} ${key.split('_')[1]}장'에 대한 오디오 링크를 찾을 수 없습니다.`);
                    }
                });
            });

            playPauseBtn.addEventListener('click', () => {
                if (isPlaying) {
                    player.pauseVideo();
                } else {
                    player.playVideo();
                }
            });

            closePlayerBtn.addEventListener('click', () => {
                player.stopVideo();
                audioPlayerBar.classList.remove('show');
            });
            
            // Initial load
            loadAudioLinks();
        });
    </script>

</body>
</html>
