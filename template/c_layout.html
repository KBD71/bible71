<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- TITLE_PLACEHOLDER -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0f2f5; }
        .infographic-card {
            background-color: white;
            border-radius: 0.75rem;
            border-width: 1px;
            border-color: #e5e7eb;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .infographic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .icon-bg {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 4rem;
            height: 4rem;
            border-radius: 9999px;
        }
    </style>
</head>
<body class="antialiased text-slate-800">
    <div class="min-h-screen container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-12">
            <!-- HEADER_CONTENT_PLACEHOLDER -->
        </header>
        
        <main>
            <!-- MAIN_CONTENT_PLACEHOLDER -->
        </main>

        <footer class="text-center mt-16 text-gray-500">
            <p>&copy; 2023 날마다 읽는 교리. All rights reserved.</p>
        </footer>
    </div>
    
    <div id="player-controls" class="fixed bottom-5 right-5 z-50">
        <button id="listen-btn" disabled class="bg-gray-400 text-white font-bold py-3 px-6 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 ease-in-out transform hover:scale-105">
            <svg id="play-icon" class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <svg id="pause-icon" class="w-6 h-6 mr-2 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span id="listen-btn-text">연결 중...</span>
        </button>
    </div>
    
    <div id="hidden-player-container" style="position: absolute; top: -9999px; left: -9999px;"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const listenBtn = document.getElementById('listen-btn');
            const listenBtnText = document.getElementById('listen-btn-text');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            let player;
            let isPlaying = false;

            function getYoutubeId(url) {
                if (!url) return null;
                let ID = '';
                url = url.replace(/(>|<)/gi, '').split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);
                if (url[2] !== undefined) {
                    ID = url[2].split(/[^0-9a-z_\-]/i);
                    ID = ID[0];
                } else {
                    ID = url;
                }
                return ID;
            }

            async function setupAudioPlayer() {
                try {
                    const path = window.location.pathname;
                    const pageName = path.split('/').pop().replace('.html', '');
                    const addressFilePath = `../address/${pageName}.txt`;
                    
                    const response = await fetch(addressFilePath);
                    if (!response.ok) {
                        throw new Error(`Address file not found`);
                    }
                    const fileContent = await response.text();

                    // --- 수정된 부분 시작 ---
                    const lines = fileContent.split('\\n');
                    const audioLine = lines.find(line => line.trim().startsWith('c:'));

                    if (!audioLine) {
                        throw new Error(`URL with 'c:' prefix not found in ${pageName}.txt`);
                    }
                    
                    const url = audioLine.trim().substring(2).trim(); // "c:" 접두어 제거
                    // --- 수정된 부분 끝 ---

                    const videoId = getYoutubeId(url);

                    if (!videoId) {
                        throw new Error('Invalid YouTube URL found');
                    }
                    
                    if (window.YT && window.YT.Player) {
                        createPlayer(videoId);
                    } else {
                        var tag = document.createElement('script');
                        tag.src = "https://www.youtube.com/iframe_api";
                        var firstScriptTag = document.getElementsByTagName('script')[0];
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                        
                        window.onYouTubeIframeAPIReady = function() {
                            createPlayer(videoId);
                        }
                    }

                } catch (error) {
                    console.error('Error setting up audio player:', error);
                    listenBtnText.textContent = '업로드 전입니다';
                    listenBtn.classList.remove('bg-gray-400');
                    listenBtn.classList.add('bg-red-500');
                }
            }
            
            function createPlayer(videoId) {
                player = new YT.Player('hidden-player-container', {
                    height: '0',
                    width: '0',
                    videoId: videoId,
                    events: {
                        'onReady': onPlayerReady
                    }
                });
            }

            function onPlayerReady(event) {
                listenBtnText.textContent = 'AI 요약 듣기';
                listenBtn.disabled = false;
                listenBtn.classList.remove('bg-gray-400');
                listenBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
            }

            listenBtn.addEventListener('click', () => {
                if (player && typeof player.playVideo === 'function') {
                    if (isPlaying) {
                        player.pauseVideo();
                        isPlaying = false;
                        playIcon.classList.remove('hidden');
                        pauseIcon.classList.add('hidden');
                    } else {
                        player.playVideo();
                        isPlaying = true;
                        playIcon.classList.add('hidden');
                        pauseIcon.classList.remove('hidden');
                    }
                }
            });

            setupAudioPlayer();
        });
    </script>

    <!-- 챗봇 트리거 스크립트 추가 (iframe용) -->
    <script src="../chatbot-trigger.js"></script>
</body>
</html>

