<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- TITLE_PLACEHOLDER -->
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .infographic-card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            border-width: 1px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }
        .infographic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .icon-bg {
            width: 4rem;
            height: 4rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
    </style>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
</head>
<body class="bg-slate-50 text-gray-800">
    <div id="root">
        <header class="bg-white shadow-sm sticky top-0 z-10">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <h1 class="text-xl font-bold text-slate-700">날마다 읽는 교리</h1>
                <button id="listen-btn" disabled class="bg-gray-400 text-white font-semibold py-2 px-4 rounded-lg flex items-center transition-colors duration-300 disabled:cursor-not-allowed">
                    <svg id="play-icon" class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                    <svg id="pause-icon" class="w-5 h-5 mr-2 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm4 0a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                    <span id="listen-btn-text">준비 중...</span>
                </button>
            </div>
        </header>

        <main class="container mx-auto p-4 md:p-8">
            <div class="text-center mb-12">
                <!-- HEADER_CONTENT_PLACEHOLDER -->
            </div>
            
            <div class="max-w-4xl mx-auto">
                <!-- MAIN_CONTENT_PLACEHOLDER -->
            </div>
        </main>

        <footer class="bg-white mt-12 py-6 border-t">
            <div class="container mx-auto px-4 text-center text-gray-500">
                <p>&copy; 2024 날마다 읽는 교리. All rights reserved.</p>
            </div>
        </footer>
    </div>
    <div id="hidden-player-container" class="hidden"></div>

    <!-- 오디오 플레이어 스크립트 -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const listenBtn = document.getElementById('listen-btn');
            const listenBtnText = document.getElementById('listen-btn-text');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            let player;
            let isPlaying = false;

            function getYoutubeId(url) {
                if (!url) return null;
                let ID = '';
                url = url.replace(/(>|<)/gi, '').split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);
                if (url[2] !== undefined) {
                    ID = url[2].split(/[^0-9a-z_\-]/i);
                    ID = ID[0];
                } else {
                    ID = url;
                }
                return ID;
            }

            async function setupAudioPlayer() {
                try {
                    const path = window.location.pathname;
                    const pageName = path.split('/').pop().replace('.html', ''); // e.g., '0912'
                    
                    const addressFilePath = `../address/${pageName}.txt`; 
                    
                    const response = await fetch(addressFilePath);
                    if (!response.ok) {
                        throw new Error(`Audio address file not found at ${addressFilePath}`);
                    }
                    const url = await response.text();
                    const videoId = getYoutubeId(url.trim());

                    if (!videoId) {
                        throw new Error('Invalid YouTube URL in file');
                    }
                    
                    if (window.YT && window.YT.Player) {
                         createPlayer(videoId);
                    } else {
                        var tag = document.createElement('script');
                        tag.src = "https://www.youtube.com/iframe_api";
                        var firstScriptTag = document.getElementsByTagName('script')[0];
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                        
                        window.onYouTubeIframeAPIReady = () => createPlayer(videoId);
                    }

                } catch (error) {
                    console.error('Error setting up audio player:', error);
                    listenBtnText.textContent = '업로드 전입니다';
                    listenBtn.classList.remove('bg-gray-400');
                    listenBtn.classList.add('bg-red-500');
                }
            }

            function createPlayer(videoId) {
                player = new YT.Player('hidden-player-container', {
                    height: '0',
                    width: '0',
                    videoId: videoId,
                    events: {
                        'onReady': onPlayerReady
                    }
                });
            }

            function onPlayerReady(event) {
                listenBtnText.textContent = 'AI 요약 듣기';
                listenBtn.disabled = false;
                listenBtn.classList.remove('bg-gray-400');
                listenBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
            }

            listenBtn.addEventListener('click', () => {
                if (player && typeof player.playVideo === 'function') {
                    if (isPlaying) {
                        player.pauseVideo();
                        isPlaying = false;
                        playIcon.classList.remove('hidden');
                        pauseIcon.classList.add('hidden');
                    } else {
                        player.playVideo();
                        isPlaying = true;
                        playIcon.classList.add('hidden');
                        pauseIcon.classList.remove('hidden');
                    }
                }
            });
            
            // 페이지가 로드되면 오디오 플레이어 설정을 시작합니다.
            setupAudioPlayer();
        });
    </script>
</body>
</html>
