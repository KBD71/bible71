<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>날마다 읽는 교리 - 1월 1일</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" as="style" crossorigin="anonymous" />
    <style>
        body {
            font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            word-break: keep-all;
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem; /* lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* lg */
            margin-bottom: 1.5rem; /* 6 */
            overflow: hidden;
        }
        .card-header {
            background-color: #4a5568; /* Tailwind gray-700 */
            color: white;
            padding: 1rem 1.5rem;
            font-size: 1.25rem; /* xl */
            font-weight: 700;
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
        }
        .card-body {
            padding: 1.5rem;
            line-height: 1.75;
        }
        .card-body h3 {
            font-size: 1.125rem; /* lg */
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #1f2937; /* gray-800 */
        }
        .card-body p {
            margin-bottom: 1rem;
            color: #374151; /* gray-700 */
        }
        .card-body ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: #374151; /* gray-700 */
        }
        .card-body li {
            margin-bottom: 0.5rem;
        }
        .card-body .question {
            font-weight: 600;
            color: #111827; /* gray-900 */
        }
        .card-body .answer {
            color: #374151; /* gray-700 */
        }
        .audio-player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            background-color: #f9fafb; /* gray-50 */
            border-top: 1px solid #e5e7eb; /* gray-200 */
        }
        .audio-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .audio-button:disabled {
            background-color: #e5e7eb; /* gray-200 */
            color: #9ca3af; /* gray-400 */
            cursor: not-allowed;
        }
        .audio-button.play {
            background-color: #2563eb; /* blue-600 */
            color: white;
        }
        .audio-button.play:hover {
            background-color: #1d4ed8; /* blue-700 */
        }
        .audio-button.pause {
            background-color: #f87171; /* red-400 */
            color: white;
        }
        .audio-button.pause:hover {
            background-color: #ef4444; /* red-500 */
        }
        .audio-error {
            color: #dc2626; /* red-600 */
            font-weight: 500;
            text-align: center;
        }
        #player-container {
            width: 1px;
            height: 1px;
            opacity: 0;
            position: absolute;
            top: -100px;
            left: -100px;
        }
        footer {
            text-align: center;
            padding: 2rem 1rem;
            font-size: 0.875rem; /* sm */
            color: #6b7280; /* gray-500 */
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto max-w-3xl px-4 py-8 sm:py-12">

        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800">1월 1일</h1>
            <p class="text-xl text-gray-600 mt-2">사람에게 주어진 첫째가며 가장 높은 목적은 무엇입니까?</p>
        </header>

        <main>
            <div class="card">
                <div class="card-header">
                    AI요약 듣기
                </div>
                <div class="audio-player-container" id="audio-player-ui">
                    <div id="player-container"></div>
                    <button id="audio-button" class="audio-button play" aria-label="교리 오디오 재생" disabled>
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2">
                            <path fill-rule="evenodd" d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" />
                        </svg>
                        <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2" style="display: none;">
                            <path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Zm7.5 0a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z" clip-rule="evenodd" />
                        </svg>
                        <span id="button-text">로딩 중...</span>
                    </button>
                    <div id="audio-error" class="audio-error mt-4" style="display: none;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    소요리문답 1문
                </div>
                <div class="card-body">
                    <div class="question-answer">
                        <p class="question">문1. 사람에게 주어진 첫째가는 목적은 무엇입니까?</p>
                        <p class="answer">답. 사람에게 주어진 첫째가는 목적은 영원토록 하나님을 영화롭게 함과 즐거워함입니다.</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    대요리문답 1문
                </div>
                <div class="card-body">
                    <div class="question-answer">
                        <p class="question">문1. 사람에게 주어진 첫째가며 가장 높은 목적은 무엇입니까?</p>
                        <p class="answer">답. 사람에게 주어진 첫째가며 가장 높은 목적은 영원토록 하나님을 영화롭게 함과 온전히 즐거워함입니다.</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    교리 해설
                </div>
                <div class="card-body">
                    <p>사람의 생명은 스스로 존재하는 것이 아닙니다. 창조주 하나님께서 주신 것입니다. 그러므로 피조물인 사람이 가장 복된 삶을 사는 길은 <strong class="text-blue-600">창조주 하나님께서 부여하신 목적</strong>을 따라 사는 데에 있습니다. 그 목적은 바로 '하나님을 영화롭게 하고 하나님을 온전히 즐거워하는 일'입니다.</p>

                    <h3>1. 목적의 기원과 이유</h3>
                    <p>이 목적은 사람이 자신의 필요를 따라 스스로 정한 것이 아니라, 창조주 하나님께서 부여하신 것입니다. 하나님께서 사람의 영광이나 즐거움을 필요로 하셔서 이 목적을 주신 것이 아닙니다. 하나님께서는 스스로 영광스러우시며 스스로 기쁨 가운데 거하시는, 부족함이 없으신 분입니다. 그럼에도 불구하고 이 목적을 사람에게 두신 이유는 이것이 피조물인 사람에게 <strong class="text-blue-600">가장 큰 복</strong>이기 때문이며, 이 큰 복을 주시고자 하시는 하나님의 사랑 때문입니다.</p>

                    <h3>2. 하나님을 영화롭게 한다는 것</h3>
                    <p>하나님을 영화롭게 하는 것은 창조주 하나님의 지혜와 권능의 영광을 찬양하는 것입니다. 또한 선택한 백성을 향한 하나님의 긍휼의 영광과 악인을 향한 하나님의 공의의 영광을 인정하고 높이는 것입니다. 우리는 일상의 생활 가운데 경험하고 인지하는 하나님의 섭리를 감사하고, 특별히 예배 가운데 하나님의 은혜를 높임으로써 그분을 영화롭게 할 수 있습니다.</p>

                    <h3>3. 하나님을 즐거워한다는 것</h3>
                    <p>하나님을 즐거워한다는 것은 하나님만을 사모하고 하나님께 가까이 나아가기를 기뻐하는 것입니다. 또한 하나님께서 행하신 모든 일과 교훈의 말씀을 고백하고 전파하며, 그로 인하여 구원을 즐거워하는 것입니다. 이처럼 하나님을 영화롭게 하고 그분을 즐거워하는 일이 인생의 가장 큰 목적이자 사명이며, 또한 우리가 살아가는 이유입니다.</p>
                </div>
            </div>
        </main>

        <footer>
            <p>교재는 날마다 양식으로 읽는 웨스트민스터 표준교리(영음사)를 사용합니다</p>
        </footer>

    </div>

    <script>
        let player;
        let videoId = null;
        let isPlayerReady = false;
        let isPlaying = false;
        const audioButton = document.getElementById('audio-button');
        const buttonText = document.getElementById('button-text');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const errorContainer = document.getElementById('audio-error');
        const playerUi = document.getElementById('audio-player-ui');

        // 1. YouTube API 로드
        function loadYouTubeAPI() {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        // 2. API 콜백 함수
        function onYouTubeIframeAPIReady() {
            fetchAudioAddress();
        }

        // 3. 오디오 주소 fetch 및 파싱
        async function fetchAudioAddress() {
            try {
                const response = await fetch('../address/dcaddr.txt');
                if (!response.ok) {
                    throw new Error('오디오 목록 파일을 불러오는 데 실패했습니다.');
                }
                const text = await response.text();
                const lines = text.split('\n');
                const today = getFormattedDate();
                const todayLine = lines.find(line => line.startsWith(today));

                if (todayLine) {
                    // 비디오 ID 추출 (URL 전체에서 ID만 정확히 파싱)
                    // 정규식: (v=... 또는 youtu.be/...) 다음에 오는 비디오 ID (특수문자 포함)
                    const regex = /(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                    const match = todayLine.match(regex);
                    if (match && match[1]) {
                        videoId = match[1];
                        initializePlayer();
                    } else {
                        throw new Error('오늘 날짜의 오디오 주소 형식이 올바르지 않습니다.');
                    }
                } else {
                    // 오늘 날짜의 주소가 없는 경우
                    showError('오늘의 AI요약 음성은 아직 업로드 전입니다.');
                }
            } catch (error) {
                console.error('Error fetching audio address:', error);
                showError(error.message || '오디오를 불러오는 중 오류가 발생했습니다.');
            }
        }

        // 4. 오늘 날짜 포맷 (MMDD)
        function getFormattedDate() {
            // 1월 1일로 고정
            return '0101';
        }

        // 5. 플레이어 초기화
        function initializePlayer() {
            player = new YT.Player('player-container', {
                height: '1',
                width: '1',
                videoId: videoId,
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'showinfo': 0,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // 6. 플레이어 준비 완료
        function onPlayerReady(event) {
            isPlayerReady = true;
            audioButton.disabled = false;
            buttonText.textContent = 'AI요약 듣기';
            audioButton.setAttribute('aria-label', '교리 오디오 재생');
            audioButton.addEventListener('click', togglePlayPause);
        }

        // 7. 플레이어 상태 변경
        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                updateButtonUI(true);
            } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
                isPlaying = false;
                updateButtonUI(false);
                if (event.data === YT.PlayerState.ENDED) {
                    player.seekTo(0); // 끝나면 처음으로 되감기
                }
            }
        }

        // 8. 재생/일시정지 토글
        function togglePlayPause() {
            if (!isPlayerReady) return;
            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        // 9. 버튼 UI 업데이트
        function updateButtonUI(playing) {
            if (playing) {
                audioButton.classList.remove('play');
                audioButton.classList.add('pause');
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'inline';
                buttonText.textContent = '일시정지';
                audioButton.setAttribute('aria-label', '교리 오디오 일시정지');
            } else {
                audioButton.classList.remove('pause');
                audioButton.classList.add('play');
                playIcon.style.display = 'inline';
                pauseIcon.style.display = 'none';
                buttonText.textContent = 'AI요약 듣기';
                audioButton.setAttribute('aria-label', '교리 오디오 재생');
            }
        }

        // 10. 오류 처리
        function showError(message) {
            // 기존 UI 숨기기
            const button = document.getElementById('audio-button');
            if (button) {
                button.style.display = 'none';
            }
            
            // 오류 메시지 표시
            errorContainer.textContent = message;
            errorContainer.style.display = 'block';
        }

        // API 로드 시작
        loadYouTubeAPI();
    </script>

</body>
</html>
