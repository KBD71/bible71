<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>날마다 읽는 교리 - 11월 13일</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" as="style" crossorigin="anonymous" />
    <style>
        body {
            font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            word-break: keep-all;
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem; /* lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* lg */
            margin-bottom: 1.5rem; /* 6 */
            overflow: hidden;
        }
        .card-header {
            background-color: #4a5568; /* Tailwind gray-700 */
            color: white;
            padding: 1rem 1.5rem;
            font-size: 1.25rem; /* xl */
            font-weight: 700;
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
        }
        .card-body {
            padding: 1.5rem;
            line-height: 1.75;
        }
        .card-body h3 {
            font-size: 1.125rem; /* lg */
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #1f2937; /* gray-800 */
        }
        .card-body p {
            margin-bottom: 1rem;
            color: #374151; /* gray-700 */
        }
        .card-body ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: #374151; /* gray-700 */
        }
        .card-body li {
            margin-bottom: 0.5rem;
        }
        .card-body .question {
            font-weight: 600;
            color: #111827; /* gray-900 */
        }
        .card-body .answer {
            color: #374151; /* gray-700 */
        }
        .audio-player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            background-color: #f9fafb; /* gray-50 */
            border-top: 1px solid #e5e7eb; /* gray-200 */
        }
        .audio-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent;
        }
        .audio-button:disabled {
            background-color: #e5e7eb; /* gray-200 */
            color: #9ca3af; /* gray-400 */
            cursor: not-allowed;
        }
        .audio-button.play {
            background-color: #2563eb; /* blue-600 */
            color: white;
        }
        .audio-button.play:hover {
            background-color: #1d4ed8; /* blue-700 */
        }
        .audio-button.pause {
            background-color: #f87171; /* red-400 */
            color: white;
        }
        .audio-button.pause:hover {
            background-color: #ef4444; /* red-500 */
        }
        .audio-error {
            color: #dc2626; /* red-600 */
            font-weight: 500;
            text-align: center;
        }
        #player-container {
            width: 1px;
            height: 1px;
            opacity: 0;
            position: absolute;
            top: -100px;
            left: -100px;
        }
        footer {
            text-align: center;
            padding: 2rem 1rem;
            font-size: 0.875rem; /* sm */
            color: #6b7280; /* gray-500 */
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto max-w-3xl px-4 py-8 sm:py-12">

        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800">11월 13일</h1>
            <p class="text-xl text-gray-600 mt-2">성례가 구원의 효과 있는 수단이 되는 근거</p>
        </header>

        <main>
            <div class="card">
                <div class="card-header">
                    AI요약 듣기
                </div>
                <div class="audio-player-container" id="audio-player-ui">
                    <div id="player-container"></div>
                    <button id="audio-button" class="audio-button play" aria-label="교리 오디오 재생" disabled>
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2">
                            <path fill-rule="evenodd" d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" />
                        </svg>
                        <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2" style="display: none;">
                            <path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Zm7.5 0a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z" clip-rule="evenodd" />
                        </svg>
                        <span id="button-text">로딩 중...</span>
                    </button>
                    <div id="audio-error" class="audio-error mt-4" style="display: none;"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    신앙고백서 27.3
                </div>
                <div class="card-body">
                    <p class="answer">성례가 바르게 시행될 때, 성례 안에서 또 성례에 의하여 제시되는 은혜는 성례 안에 있는 어떤 힘에 의해 주어지는 것이 아니다. 성례의 효력은 집례자의 경건이나 의향에 의존하는 것이 아니라, 성령 하나님의 역사하심과 제정의 말씀에 의존한다. 이 제정의 말씀은 성례의 시행 권한을 부여하는 명령과 더불어, 합당하게 받는 자에게 제시되는 은택의 약속을 담고 있다.</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    교리 해설
                </div>
                <div class="card-body">
                    <p>오늘 읽는 신앙고백서 27.3은 어제 살핀 대요리문답 161항과 내용이 대체로 같습니다. 두 문서는 모두 성례가 구원의 효과 있는 수단이 되는 근거, 곧 그 효력이 집례자의 개인적이거나 주관적인 상태에 따라 결정되지 않는다는 점을 분명히 진술합니다. 그럼에도 신앙고백서는 강조점이 다르고 추가적인 표현을 사용함으로써 나름의 특징을 보입니다. 이 내용을 세 부분으로 나누어 살펴보겠습니다.</p>

                    <h3>1. 성례 안에서 "제시되는" 은혜 (exhibited)</h3>
                    <p>신앙고백서는 그리스도의 구속의 은혜가 성례 안에서 또는 성례를 통하여 <strong class="text-blue-600">"제시된다"(exhibited)</strong>고 진술합니다. 이는 성례가 단지 그리스도의 은혜를 기념하는 표지(츠빙글리의 기념설)에 머무르거나, 그 약속을 확증하는(인치는) 것만이 아님을 밝힙니다. 성례는 새 언약의 유익을 가리킬 뿐 아니라, 그것을 참되게 제시합니다.</p>
                    <p>동시에 "제시한다"는 이 표현은 로마 가톨릭의 화체설이나 루터파의 공재설을 배격합니다.</p>
                    <ul>
                        <li><strong class="text-blue-600">화체설(로마 가톨릭)</strong>: 빵과 포도주의 본질이 그리스도의 몸과 피로 변한다고 주장합니다.</li>
                        <li><strong class="text-blue-600">공재설(루터파)</strong>: 빵과 포도주와 함께, 안에, 아래에 그리스도의 몸과 피가 실제로 임재한다고 가르칩니다.</li>
                    </ul>
                    <p>이와 달리, 신앙고백서가 말하는 "제시"는 성례 안에 은혜가 객관적으로 참되게(truly), 실재로(really) 존재하지만, 이는 <strong class="text-blue-600">물질적이 아니라 "영적으로" 임재</strong>함을 의미합니다.</p>

                    <h3>2. 효력의 근거: 성례 자체나 집례자가 아님</h3>
                    <p>신앙고백서는 성례의 표지가 은혜를 제시함을 분명히 한 후, 그 은혜가 "성례 안에 있는 어떤 힘" 곧 성례의 요소나 행위 자체에 내재하는 능력에 의해 주어지는 것이 아님을 선언합니다. 이는 로마 가톨릭이 주장한 <strong class="text-blue-600">'사효성'(ex opere operato)</strong>, 즉 행위 그 자체로 효력이 발생한다는 교리를 반박하는 것입니다. 또한, 성례의 은혜가 집례자의 경건이나 의도에 의존하지 않음도 분명히 밝힙니다.</p>

                    <h3>3. 효력의 근거: "성령의 역사"와 "제정의 말씀"</h3>
                    <p>대요리문답 161항은 성례의 효력이 "성령 하나님의 역사하심"과 "그리스도의 복 주심" 때문이라고 진술합니다. 신앙고백서는 이에 더하여 성례의 효력이 <strong class="text-blue-600">"성령 하나님의 역사하심과 제정의 말씀에 의존한다"</strong>고 말합니다.</p>
                    <ul>
                        <li>
                            <strong class="text-blue-600">제정의 말씀</strong>: 이 말씀에는 성례 시행의 명령과 은혜의 약속이 함께 담겨 있습니다. 성례의 효력이 이 말씀에 의존한다는 것은, 그 효력의 <strong class="text-blue-600">객관적 근거</strong>가 그리스도의 명령과 약속에 있음을 명확히 하는 것입니다.
                        </li>
                        <li>
                            <strong class="text-blue-600">성령 하나님의 역사하심</strong>: 성령께서는 객관적으로는 그리스도의 공로에 근거하여 성례 속 약속이 신자에게 전달될 것을 보증하십니다. 또한 주관적으로는 신자에게 믿음을 주시고 강화하심으로써, 성례에 제시된 은혜를 실제로 받게 하십니다. 이를 통해 신자는 보이지 않는 실체이신 그리스도와 그분의 은택들을 영적으로, 그러나 참되게 받게 됩니다.
                        </li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    적용 질문
                </div>
                <div class="card-body">
                    <ul>
                        <li><span class="question">1. 성례가 단순한 기념이나 상징에 머무르지 않으면서도, 동시에 빵과 포도주의 본질이 변한다고 보는 화체설이나 그리스도의 몸이 물질적으로 함께 있다고 보는 공재설과도 다르다고 할 때, 신앙고백서가 말하는 "제시한다'라는 표현은 어떤 의미를 지닐까요? 여러분은 성찬에 참여할 때 물질적 변화나 단순한 상징이 아니라, 성령의 역사 안에서 그리스도의 은혜가 실제로 우리에게 제시되고 있다는 사실을 믿음으로 붙들고 있습니까?</span></li>
                        <li><span class="question">2. 신앙고백서는 성례의 효력이 "성례 안에 있는 어떤 힘 에 의한 것이 아니라고 가르칩니다. 그렇다면 성례의 능력은 어디에서 오는 것입니까? 여러분은 성례 행위 자체나 그것을 집례하는 사람의 경건함이 아니라, 하나님께서 정하신 말씀과 성령의 역사에 의존한다는 사실을 믿으며 성례에 참여하고 있습니까?</span></li>
                        <li><span class="question">3. 성례의 효력이 집례자의 의도나 상태에 의존하지 않는다고 할 때, 이는 성례의 객관적 신뢰성을 어떻게 드러내는 것입니까? 여러분은 성례가 사람의 자격이나 감정에 좌우되지 않고, 하나님께서 세우신 언약의 약속에 따라 효력을 나타낸다는 사실 속에서 위로를 얻고 있습니까?</span></li>
                        <li><span class="question">4. 신앙고백서는 성례의 효력이 "성령 하나님의 역사하심과 제정의 말씀에 의존한다"라고 진술합니다. 이는 성례가 어떤 방식으로 우리에게 실제적인 은혜를 전달함을 의미합니까? 여러분은 성령께서 믿음을 주시고 강화하심으로써 성례를 통해 보이지 않는 그리스도와 그분의 은택들을 실제로 받게 하신다는 사실을 확신하며, 성례에 임할 때마다 그 은혜를 사모하고 있습니까?</span></li>
                    </ul>
                </div>
            </div>
        </main>

        <footer>
            <p>교재는 날마다 양식으로 읽는 웨스트민스터 표준교리(영음사)를 사용합니다</p>
        </footer>

    </div>

    <script>
        let player;
        let videoId = null;
        let isPlayerReady = false;
        let isPlaying = false;
        const audioButton = document.getElementById('audio-button');
        const buttonText = document.getElementById('button-text');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const errorContainer = document.getElementById('audio-error');
        const playerUi = document.getElementById('audio-player-ui');

        // 1. YouTube API 로드
        function loadYouTubeAPI() {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        // 2. API 콜백 함수
        function onYouTubeIframeAPIReady() {
            fetchAudioAddress();
        }

        // 3. 오디오 주소 fetch 및 파싱
        async function fetchAudioAddress() {
            try {
                const response = await fetch('../address/dcaddr.txt');
                if (!response.ok) {
                    throw new Error('오디오 목록 파일을 불러오는 데 실패했습니다.');
                }
                const text = await response.text();
                const lines = text.split('\n');
                const today = getFormattedDate();
                const todayLine = lines.find(line => line.startsWith(today));

                if (todayLine) {
                    // 비디오 ID 추출 (URL 전체에서 ID만 정확히 파싱)
                    // 정규식: (v=... 또는 youtu.be/...) 다음에 오는 비디오 ID (특수문자 포함)
                    const regex = /(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                    const match = todayLine.match(regex);
                    if (match && match[1]) {
                        videoId = match[1];
                        initializePlayer();
                    } else {
                        throw new Error('오늘 날짜의 오디오 주소 형식이 올바르지 않습니다.');
                    }
                } else {
                    // 오늘 날짜의 주소가 없는 경우
                    showError('오늘의 AI요약 음성은 아직 업로드 전입니다.');
                }
            } catch (error) {
                console.error('Error fetching audio address:', error);
                showError(error.message || '오디오를 불러오는 중 오류가 발생했습니다.');
            }
        }

        // 4. 오늘 날짜 포맷 (MMDD)
        function getFormattedDate() {
            const now = new Date();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            // return `${month}${day}`;
            return '1113'; // 요청된 날짜로 고정
        }

        // 5. 플레이어 초기화
        function initializePlayer() {
            player = new YT.Player('player-container', {
                height: '1',
                width: '1',
                videoId: videoId,
                playerVars: {
                    'playsinline': 1,
                    'controls': 0,
                    'showinfo': 0,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // 6. 플레이어 준비 완료
        function onPlayerReady(event) {
            isPlayerReady = true;
            audioButton.disabled = false;
            buttonText.textContent = 'AI요약 듣기';
            audioButton.setAttribute('aria-label', '교리 오디오 재생');
            audioButton.addEventListener('click', togglePlayPause);
        }

        // 7. 플레이어 상태 변경
        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                isPlaying = true;
                updateButtonUI(true);
            } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
                isPlaying = false;
                updateButtonUI(false);
                if (event.data === YT.PlayerState.ENDED) {
                    player.seekTo(0); // 끝나면 처음으로 되감기
                }
            }
        }

        // 8. 재생/일시정지 토글
        function togglePlayPause() {
            if (!isPlayerReady) return;
            if (isPlaying) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        // 9. 버튼 UI 업데이트
        function updateButtonUI(playing) {
            if (playing) {
                audioButton.classList.remove('play');
                audioButton.classList.add('pause');
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'inline';
                buttonText.textContent = '일시정지';
                audioButton.setAttribute('aria-label', '교리 오디오 일시정지');
            } else {
                audioButton.classList.remove('pause');
                audioButton.classList.add('play');
                playIcon.style.display = 'inline';
                pauseIcon.style.display = 'none';
                buttonText.textContent = 'AI요약 듣기';
                audioButton.setAttribute('aria-label', '교리 오디오 재생');
            }
        }

        // 10. 오류 처리
        function showError(message) {
            // 기존 UI 숨기기
            const button = document.getElementById('audio-button');
            if (button) {
                button.style.display = 'none';
            }
            
            // 오류 메시지 표시
            errorContainer.textContent = message;
            errorContainer.style.display = 'block';
        }

        // API 로드 시작
        loadYouTubeAPI();
    </script>

</body>
</html>
